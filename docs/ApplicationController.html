<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Class: ApplicationController
  
    &mdash; Documentation by YARD 0.9.19
  
</title>

  <link rel="stylesheet" href="css/style.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="css/common.css" type="text/css" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  pathId = "ApplicationController";
  relpath = '';
</script>


  <script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="_index.html">Index (A)</a> &raquo;
    
    
    <span class="title">ApplicationController</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><h1>Class: ApplicationController
  
  
  
</h1>
<div class="box_info">
  
  <dl>
    <dt>Inherits:</dt>
    <dd>
      <span class="inheritName">ActionController::Base</span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next">ActionController::Base</li>
          
            <li class="next">ApplicationController</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
    </dd>
  </dl>
  

  
  
  
  
  <dl>
      <dt>Includes:</dt>
      <dd><span class='object_link'><a href="Analytics.html" title="Analytics (module)">Analytics</a></span>, <span class='object_link'><a href="ApplicationController/DefaultURLOptions.html" title="ApplicationController::DefaultURLOptions (module)">DefaultURLOptions</a></span>, <span class='object_link'><a href="ApplicationHelper.html" title="ApplicationHelper (module)">ApplicationHelper</a></span>, <span class='object_link'><a href="EnsureAdmin.html" title="EnsureAdmin (module)">EnsureAdmin</a></span>, <span class='object_link'><a href="HSTS/Concern.html" title="HSTS::Concern (module)">HSTS::Concern</a></span>, <span class='object_link'><a href="IconHelper.html" title="IconHelper (module)">IconHelper</a></span>, <span class='object_link'><a href="RefererHider.html" title="RefererHider (module)">RefererHider</a></span></dd>
  </dl>
  
  

  

  
  <dl>
    <dt>Defined in:</dt>
    <dd>app/controllers/application_controller.rb</dd>
  </dl>
  
</div>

<div id="subclasses">
  <h2>Direct Known Subclasses</h2>
  <p class="children"><span class='object_link'><a href="AcceptPreauthorizedConversationsController.html" title="AcceptPreauthorizedConversationsController (class)">AcceptPreauthorizedConversationsController</a></span>, <span class='object_link'><a href="Admin/AdminBaseController.html" title="Admin::AdminBaseController (class)">Admin::AdminBaseController</a></span>, <span class='object_link'><a href="AmazonBouncesController.html" title="AmazonBouncesController (class)">AmazonBouncesController</a></span>, <span class='object_link'><a href="CommentsController.html" title="CommentsController (class)">CommentsController</a></span>, <span class='object_link'><a href="CommunitiesController.html" title="CommunitiesController (class)">CommunitiesController</a></span>, <span class='object_link'><a href="CommunityMembershipsController.html" title="CommunityMembershipsController (class)">CommunityMembershipsController</a></span>, <span class='object_link'><a href="ConfirmConversationsController.html" title="ConfirmConversationsController (class)">ConfirmConversationsController</a></span>, <span class='object_link'><a href="ConversationsController.html" title="ConversationsController (class)">ConversationsController</a></span>, <span class='object_link'><a href="DesignController.html" title="DesignController (class)">DesignController</a></span>, <span class='object_link'><a href="EmailsController.html" title="EmailsController (class)">EmailsController</a></span>, <span class='object_link'><a href="FeedbacksController.html" title="FeedbacksController (class)">FeedbacksController</a></span>, <span class='object_link'><a href="FollowedPeopleController.html" title="FollowedPeopleController (class)">FollowedPeopleController</a></span>, <span class='object_link'><a href="FollowersController.html" title="FollowersController (class)">FollowersController</a></span>, <span class='object_link'><a href="FreeTransactionsController.html" title="FreeTransactionsController (class)">FreeTransactionsController</a></span>, <span class='object_link'><a href="HarmonyProxyController.html" title="HarmonyProxyController (class)">HarmonyProxyController</a></span>, <span class='object_link'><a href="HomepageController.html" title="HomepageController (class)">HomepageController</a></span>, <span class='object_link'><a href="I18nController.html" title="I18nController (class)">I18nController</a></span>, <span class='object_link'><a href="InboxesController.html" title="InboxesController (class)">InboxesController</a></span>, <span class='object_link'><a href="InfosController.html" title="InfosController (class)">InfosController</a></span>, <span class='object_link'><a href="IntApi/ListingsController.html" title="IntApi::ListingsController (class)">IntApi::ListingsController</a></span>, <span class='object_link'><a href="IntApi/MarketplacesController.html" title="IntApi::MarketplacesController (class)">IntApi::MarketplacesController</a></span>, <span class='object_link'><a href="InvitationsController.html" title="InvitationsController (class)">InvitationsController</a></span>, <span class='object_link'><a href="ListingImagesController.html" title="ListingImagesController (class)">ListingImagesController</a></span>, <span class='object_link'><a href="ListingsController.html" title="ListingsController (class)">ListingsController</a></span>, <span class='object_link'><a href="MercuryUpdateController.html" title="MercuryUpdateController (class)">MercuryUpdateController</a></span>, <span class='object_link'><a href="MessagesController.html" title="MessagesController (class)">MessagesController</a></span>, <span class='object_link'><a href="OmniauthController.html" title="OmniauthController (class)">OmniauthController</a></span>, <span class='object_link'><a href="PaymentSettingsController.html" title="PaymentSettingsController (class)">PaymentSettingsController</a></span>, <span class='object_link'><a href="PaypalAccountsController.html" title="PaypalAccountsController (class)">PaypalAccountsController</a></span>, <span class='object_link'><a href="PaypalIpnController.html" title="PaypalIpnController (class)">PaypalIpnController</a></span>, <span class='object_link'><a href="PaypalService/CheckoutOrdersController.html" title="PaypalService::CheckoutOrdersController (class)">PaypalService::CheckoutOrdersController</a></span>, <span class='object_link'><a href="PersonMessagesController.html" title="PersonMessagesController (class)">PersonMessagesController</a></span>, <span class='object_link'><a href="PlansController.html" title="PlansController (class)">PlansController</a></span>, <span class='object_link'><a href="PreauthorizeTransactionsController.html" title="PreauthorizeTransactionsController (class)">PreauthorizeTransactionsController</a></span>, <span class='object_link'><a href="SessionsController.html" title="SessionsController (class)">SessionsController</a></span>, <span class='object_link'><a href="SettingsController.html" title="SettingsController (class)">SettingsController</a></span>, <span class='object_link'><a href="TermsController.html" title="TermsController (class)">TermsController</a></span>, <span class='object_link'><a href="TestimonialsController.html" title="TestimonialsController (class)">TestimonialsController</a></span>, <span class='object_link'><a href="TopbarApiController.html" title="TopbarApiController (class)">TopbarApiController</a></span>, <span class='object_link'><a href="TransactionsController.html" title="TransactionsController (class)">TransactionsController</a></span></p>
</div>
<h2>Defined Under Namespace</h2>
<p class="children">
  
    
      <strong class="modules">Modules:</strong> <span class='object_link'><a href="ApplicationController/DefaultURLOptions.html" title="ApplicationController::DefaultURLOptions (module)">DefaultURLOptions</a></span>
    
  
    
  
</p>



  <h2>Constant Summary</h2>
  
  <h3 class="inherited">Constants included
     from <span class='object_link'><a href="RefererHider.html" title="RefererHider (module)">RefererHider</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="RefererHider.html#HIDE_REFERER_ON-constant" title="RefererHider::HIDE_REFERER_ON (constant)">RefererHider::HIDE_REFERER_ON</a></span></p>

  
  
  <h3 class="inherited">Constants included
     from <span class='object_link'><a href="Analytics.html" title="Analytics (module)">Analytics</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="Analytics.html#EVENT_KEY-constant" title="Analytics::EVENT_KEY (constant)">Analytics::EVENT_KEY</a></span>, <span class='object_link'><a href="Analytics.html#LOGOUT_KEY-constant" title="Analytics::LOGOUT_KEY (constant)">Analytics::LOGOUT_KEY</a></span></p>

  
  
  <h3 class="inherited">Constants included
     from <span class='object_link'><a href="IconHelper.html" title="IconHelper (module)">IconHelper</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="IconHelper.html#ICON_PACK-constant" title="IconHelper::ICON_PACK (constant)">IconHelper::ICON_PACK</a></span></p>

  
  
  <h3 class="inherited">Constants included
     from <span class='object_link'><a href="ApplicationHelper.html" title="ApplicationHelper (module)">ApplicationHelper</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="ApplicationHelper.html#SOCIAL_LINKS-constant" title="ApplicationHelper::SOCIAL_LINKS (constant)">ApplicationHelper::SOCIAL_LINKS</a></span></p>


  <h2>Instance Attribute Summary <small><a href="#" class="summary_toggle">collapse</a></small></h2>
  <ul class="summary">
    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#current_user-instance_method" title="#current_user (instance method)">#<strong>current_user</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns the value of attribute current_user.</p>
</div></span>
  
</li>

    
  </ul>




  
    <h2>
      Instance Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#after_sign_in_path_for-instance_method" title="#after_sign_in_path_for (instance method)">#<strong>after_sign_in_path_for</strong>(resourse)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>This hook will be called by Devise after successful Facebook login.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#cannot_access_if_banned-instance_method" title="#cannot_access_if_banned (instance method)">#<strong>cannot_access_if_banned</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#cannot_access_without_confirmation-instance_method" title="#cannot_access_without_confirmation (instance method)">#<strong>cannot_access_without_confirmation</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#current_user%3F-instance_method" title="#current_user? (instance method)">#<strong>current_user?</strong>(person)  &#x21d2; Boolean </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#ensure_consent_given-instance_method" title="#ensure_consent_given (instance method)">#<strong>ensure_consent_given</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Ensure that user accepts terms of community and has a valid email.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#ensure_logged_in-instance_method" title="#ensure_logged_in (instance method)">#<strong>ensure_logged_in</strong>(warning_message)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>A before filter for views that only users that are logged in can access.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#ensure_user_belongs_to_community-instance_method" title="#ensure_user_belongs_to_community (instance method)">#<strong>ensure_user_belongs_to_community</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Ensure that user belongs to community.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#fetch_community-instance_method" title="#fetch_community (instance method)">#<strong>fetch_community</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Before filter to get the current community.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#fetch_community_admin_status-instance_method" title="#fetch_community_admin_status (instance method)">#<strong>fetch_community_admin_status</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#fetch_community_membership-instance_method" title="#fetch_community_membership (instance method)">#<strong>fetch_community_membership</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#fetch_community_plan_expiration_status-instance_method" title="#fetch_community_plan_expiration_status (instance method)">#<strong>fetch_community_plan_expiration_status</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#fetch_logged_in_user-instance_method" title="#fetch_logged_in_user (instance method)">#<strong>fetch_logged_in_user</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#initialize_feature_flags-instance_method" title="#initialize_feature_flags (instance method)">#<strong>initialize_feature_flags</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#logged_in%3F-instance_method" title="#logged_in? (instance method)">#<strong>logged_in?</strong>  &#x21d2; Boolean </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#maintenance_warning-instance_method" title="#maintenance_warning (instance method)">#<strong>maintenance_warning</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#not_available-instance_method" title="#not_available (instance method)">#<strong>not_available</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>plain stub for routes, intercepted in perfom_redirect.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#perform_redirect-instance_method" title="#perform_redirect (instance method)">#<strong>perform_redirect</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Performs redirect to correct URL, if needed.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#redirect_locale_param-instance_method" title="#redirect_locale_param (instance method)">#<strong>redirect_locale_param</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>If URL contains locale parameter that doesn&#39;t match with the selected locale, redirect to the selected locale.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#redirect_removed_locale-instance_method" title="#redirect_removed_locale (instance method)">#<strong>redirect_removed_locale</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#redirect_to_locale-instance_method" title="#redirect_to_locale (instance method)">#<strong>redirect_to_locale</strong>(new_locale, status)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#resolve_community-instance_method" title="#resolve_community (instance method)">#<strong>resolve_community</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>This can be overriden by controllers, if they have another strategy for resolving the community.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#root-instance_method" title="#root (instance method)">#<strong>root</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Creates a URL for root path (i18n breaks root_path helper).</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#save_current_host_with_port-instance_method" title="#save_current_host_with_port (instance method)">#<strong>save_current_host_with_port</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#save_current_path-instance_method" title="#save_current_path (instance method)">#<strong>save_current_path</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Saves current path so that the user can be redirected back to that path when needed.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#set_display_expiration_notice-instance_method" title="#set_display_expiration_notice (instance method)">#<strong>set_display_expiration_notice</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#set_homepage_path-instance_method" title="#set_homepage_path (instance method)">#<strong>set_homepage_path</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#set_locale-instance_method" title="#set_locale (instance method)">#<strong>set_locale</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#warn_about_missing_payment_info-instance_method" title="#warn_about_missing_payment_info (instance method)">#<strong>warn_about_missing_payment_info</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Before filter for payments, shows notification if user is not ready for payments.</p>
</div></span>
  
</li>

      
    </ul>
  


  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="HSTS/Concern.html" title="HSTS::Concern (module)">HSTS::Concern</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="HSTS/Concern.html#set_hsts-instance_method" title="HSTS::Concern#set_hsts (method)">#set_hsts</a></span></p>

  
  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="RefererHider.html" title="RefererHider (module)">RefererHider</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="RefererHider.html#force_hide_referer-instance_method" title="RefererHider#force_hide_referer (method)">#force_hide_referer</a></span>, <span class='object_link'><a href="RefererHider.html#set_hide_referer-instance_method" title="RefererHider#set_hide_referer (method)">#set_hide_referer</a></span></p>

  
  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="Analytics.html" title="Analytics (module)">Analytics</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="Analytics.html#mark_logged_out-instance_method" title="Analytics#mark_logged_out (method)">#mark_logged_out</a></span>, <span class='object_link'><a href="Analytics.html#record_event-instance_method" title="Analytics#record_event (method)">#record_event</a></span></p>

  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="ApplicationController/DefaultURLOptions.html" title="ApplicationController::DefaultURLOptions (module)">DefaultURLOptions</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="ApplicationController/DefaultURLOptions.html#default_url_options-instance_method" title="ApplicationController::DefaultURLOptions#default_url_options (method)">#default_url_options</a></span></p>

  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="IconHelper.html" title="IconHelper (module)">IconHelper</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="IconHelper.html#icon_class-instance_method" title="IconHelper#icon_class (method)">#icon_class</a></span>, <span class='object_link'><a href="IconHelper.html#icon_class_tag-instance_method" title="IconHelper#icon_class_tag (method)">#icon_class_tag</a></span>, <span class='object_link'><a href="IconHelper.html#icon_map_tag-instance_method" title="IconHelper#icon_map_tag (method)">#icon_map_tag</a></span>, <span class='object_link'><a href="IconHelper.html#icon_specified%3F-class_method" title="IconHelper.icon_specified? (method)">icon_specified?</a></span>, <span class='object_link'><a href="IconHelper.html#icon_tag-instance_method" title="IconHelper#icon_tag (method)">#icon_tag</a></span>, <span class='object_link'><a href="IconHelper.html#pick_icons-instance_method" title="IconHelper#pick_icons (method)">#pick_icons</a></span></p>

  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="ApplicationHelper.html" title="ApplicationHelper (module)">ApplicationHelper</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="ApplicationHelper.html#about_links-instance_method" title="ApplicationHelper#about_links (method)">#about_links</a></span>, <span class='object_link'><a href="ApplicationHelper.html#add_links-instance_method" title="ApplicationHelper#add_links (method)">#add_links</a></span>, <span class='object_link'><a href="ApplicationHelper.html#add_links_and_br_tags-instance_method" title="ApplicationHelper#add_links_and_br_tags (method)">#add_links_and_br_tags</a></span>, <span class='object_link'><a href="ApplicationHelper.html#add_links_and_br_tags_for_email-instance_method" title="ApplicationHelper#add_links_and_br_tags_for_email (method)">#add_links_and_br_tags_for_email</a></span>, <span class='object_link'><a href="ApplicationHelper.html#add_p_tags-instance_method" title="ApplicationHelper#add_p_tags (method)">#add_p_tags</a></span>, <span class='object_link'><a href="ApplicationHelper.html#admin_links_for-instance_method" title="ApplicationHelper#admin_links_for (method)">#admin_links_for</a></span>, <span class='object_link'><a href="ApplicationHelper.html#atom_feed_url-instance_method" title="ApplicationHelper#atom_feed_url (method)">#atom_feed_url</a></span>, <span class='object_link'><a href="ApplicationHelper.html#author_link-instance_method" title="ApplicationHelper#author_link (method)">#author_link</a></span>, <span class='object_link'><a href="ApplicationHelper.html#available_locales-instance_method" title="ApplicationHelper#available_locales (method)">#available_locales</a></span>, <span class='object_link'><a href="ApplicationHelper.html#avatar_thumb-instance_method" title="ApplicationHelper#avatar_thumb (method)">#avatar_thumb</a></span>, <span class='object_link'><a href="ApplicationHelper.html#community_blank_slate-instance_method" title="ApplicationHelper#community_blank_slate (method)">#community_blank_slate</a></span>, <span class='object_link'><a href="ApplicationHelper.html#community_description-instance_method" title="ApplicationHelper#community_description (method)">#community_description</a></span>, <span class='object_link'><a href="ApplicationHelper.html#community_slogan-instance_method" title="ApplicationHelper#community_slogan (method)">#community_slogan</a></span>, <span class='object_link'><a href="ApplicationHelper.html#default_protocol-instance_method" title="ApplicationHelper#default_protocol (method)">#default_protocol</a></span>, <span class='object_link'><a href="ApplicationHelper.html#email_link_style-instance_method" title="ApplicationHelper#email_link_style (method)">#email_link_style</a></span>, <span class='object_link'><a href="ApplicationHelper.html#email_not_accepted_message-instance_method" title="ApplicationHelper#email_not_accepted_message (method)">#email_not_accepted_message</a></span>, <span class='object_link'><a href="ApplicationHelper.html#escape_for_url-class_method" title="ApplicationHelper.escape_for_url (method)">escape_for_url</a></span>, <span class='object_link'><a href="ApplicationHelper.html#facebook_like-instance_method" title="ApplicationHelper#facebook_like (method)">#facebook_like</a></span>, <span class='object_link'><a href="ApplicationHelper.html#fetch_community_service_name_from_thread-class_method" title="ApplicationHelper.fetch_community_service_name_from_thread (method)">fetch_community_service_name_from_thread</a></span>, <span class='object_link'><a href="ApplicationHelper.html#format_local_date-instance_method" title="ApplicationHelper#format_local_date (method)">#format_local_date</a></span>, <span class='object_link'><a href="ApplicationHelper.html#get_badge_class-instance_method" title="ApplicationHelper#get_badge_class (method)">#get_badge_class</a></span>, <span class='object_link'><a href="ApplicationHelper.html#get_profile_extras_tab_class-instance_method" title="ApplicationHelper#get_profile_extras_tab_class (method)">#get_profile_extras_tab_class</a></span>, <span class='object_link'><a href="ApplicationHelper.html#has_aws_keys%3F-class_method" title="ApplicationHelper.has_aws_keys? (method)">has_aws_keys?</a></span>, <span class='object_link'><a href="ApplicationHelper.html#huge_avatar_thumb-instance_method" title="ApplicationHelper#huge_avatar_thumb (method)">#huge_avatar_thumb</a></span>, <span class='object_link'><a href="ApplicationHelper.html#js_t-instance_method" title="ApplicationHelper#js_t (method)">#js_t</a></span>, <span class='object_link'><a href="ApplicationHelper.html#landing_page_path-instance_method" title="ApplicationHelper#landing_page_path (method)">#landing_page_path</a></span>, <span class='object_link'><a href="ApplicationHelper.html#large_avatar_thumb-instance_method" title="ApplicationHelper#large_avatar_thumb (method)">#large_avatar_thumb</a></span>, <span class='object_link'><a href="ApplicationHelper.html#medium_avatar_thumb-instance_method" title="ApplicationHelper#medium_avatar_thumb (method)">#medium_avatar_thumb</a></span>, <span class='object_link'><a href="ApplicationHelper.html#missing_avatar-instance_method" title="ApplicationHelper#missing_avatar (method)">#missing_avatar</a></span>, <span class='object_link'><a href="ApplicationHelper.html#on_admin%3F-instance_method" title="ApplicationHelper#on_admin? (method)">#on_admin?</a></span>, <span class='object_link'><a href="ApplicationHelper.html#one_line_for_html_safe_content-instance_method" title="ApplicationHelper#one_line_for_html_safe_content (method)">#one_line_for_html_safe_content</a></span>, <span class='object_link'><a href="ApplicationHelper.html#pageless-instance_method" title="ApplicationHelper#pageless (method)">#pageless</a></span>, <span class='object_link'><a href="ApplicationHelper.html#pick_referer_domain_part_from_request-class_method" title="ApplicationHelper.pick_referer_domain_part_from_request (method)">pick_referer_domain_part_from_request</a></span>, <span class='object_link'><a href="ApplicationHelper.html#random_sting-class_method" title="ApplicationHelper.random_sting (method)">random_sting</a></span>, <span class='object_link'><a href="ApplicationHelper.html#regex_definition_to_js-instance_method" title="ApplicationHelper#regex_definition_to_js (method)">#regex_definition_to_js</a></span>, <span class='object_link'><a href="ApplicationHelper.html#search_mode-instance_method" title="ApplicationHelper#search_mode (method)">#search_mode</a></span>, <span class='object_link'><a href="ApplicationHelper.html#search_path-instance_method" title="ApplicationHelper#search_path (method)">#search_path</a></span>, <span class='object_link'><a href="ApplicationHelper.html#search_url-instance_method" title="ApplicationHelper#search_url (method)">#search_url</a></span>, <span class='object_link'><a href="ApplicationHelper.html#send_error_notification-class_method" title="ApplicationHelper.send_error_notification (method)">send_error_notification</a></span>, <span class='object_link'><a href="ApplicationHelper.html#service_name-instance_method" title="ApplicationHelper#service_name (method)">#service_name</a></span>, <span class='object_link'><a href="ApplicationHelper.html#settings_links_for-instance_method" title="ApplicationHelper#settings_links_for (method)">#settings_links_for</a></span>, <span class='object_link'><a href="ApplicationHelper.html#small_avatar_thumb-instance_method" title="ApplicationHelper#small_avatar_thumb (method)">#small_avatar_thumb</a></span>, <span class='object_link'><a href="ApplicationHelper.html#social_link_name-instance_method" title="ApplicationHelper#social_link_name (method)">#social_link_name</a></span>, <span class='object_link'><a href="ApplicationHelper.html#social_link_placeholder-instance_method" title="ApplicationHelper#social_link_placeholder (method)">#social_link_placeholder</a></span>, <span class='object_link'><a href="ApplicationHelper.html#sort_link_direction-instance_method" title="ApplicationHelper#sort_link_direction (method)">#sort_link_direction</a></span>, <span class='object_link'><a href="ApplicationHelper.html#store_community_service_name_to_thread-class_method" title="ApplicationHelper.store_community_service_name_to_thread (method)">store_community_service_name_to_thread</a></span>, <span class='object_link'><a href="ApplicationHelper.html#store_community_service_name_to_thread_from_community-class_method" title="ApplicationHelper.store_community_service_name_to_thread_from_community (method)">store_community_service_name_to_thread_from_community</a></span>, <span class='object_link'><a href="ApplicationHelper.html#store_community_service_name_to_thread_from_community_id-class_method" title="ApplicationHelper.store_community_service_name_to_thread_from_community_id (method)">store_community_service_name_to_thread_from_community_id</a></span>, <span class='object_link'><a href="ApplicationHelper.html#text_with_line_breaks-instance_method" title="ApplicationHelper#text_with_line_breaks (method)">#text_with_line_breaks</a></span>, <span class='object_link'><a href="ApplicationHelper.html#text_with_line_breaks_for_email-instance_method" title="ApplicationHelper#text_with_line_breaks_for_email (method)">#text_with_line_breaks_for_email</a></span>, <span class='object_link'><a href="ApplicationHelper.html#text_with_line_breaks_html_safe-instance_method" title="ApplicationHelper#text_with_line_breaks_html_safe (method)">#text_with_line_breaks_html_safe</a></span>, <span class='object_link'><a href="ApplicationHelper.html#text_with_url_links-instance_method" title="ApplicationHelper#text_with_url_links (method)">#text_with_url_links</a></span>, <span class='object_link'><a href="ApplicationHelper.html#time_ago-instance_method" title="ApplicationHelper#time_ago (method)">#time_ago</a></span>, <span class='object_link'><a href="ApplicationHelper.html#translate_time_to-instance_method" title="ApplicationHelper#translate_time_to (method)">#translate_time_to</a></span>, <span class='object_link'><a href="ApplicationHelper.html#tribe_latitude-instance_method" title="ApplicationHelper#tribe_latitude (method)">#tribe_latitude</a></span>, <span class='object_link'><a href="ApplicationHelper.html#tribe_longitude-instance_method" title="ApplicationHelper#tribe_longitude (method)">#tribe_longitude</a></span>, <span class='object_link'><a href="ApplicationHelper.html#us_states-instance_method" title="ApplicationHelper#us_states (method)">#us_states</a></span>, <span class='object_link'><a href="ApplicationHelper.html#use_s3%3F-class_method" title="ApplicationHelper.use_s3? (method)">use_s3?</a></span>, <span class='object_link'><a href="ApplicationHelper.html#use_upload_s3%3F-class_method" title="ApplicationHelper.use_upload_s3? (method)">use_upload_s3?</a></span>, <span class='object_link'><a href="ApplicationHelper.html#username_label-instance_method" title="ApplicationHelper#username_label (method)">#username_label</a></span>, <span class='object_link'><a href="ApplicationHelper.html#username_or_email_label-instance_method" title="ApplicationHelper#username_or_email_label (method)">#username_or_email_label</a></span>, <span class='object_link'><a href="ApplicationHelper.html#with_invite_link-instance_method" title="ApplicationHelper#with_invite_link (method)">#with_invite_link</a></span></p>

  
  <div id="instance_attr_details" class="attr_details">
    <h2>Instance Attribute Details</h2>
    
      
      <span id=""></span>
      <div class="method_details first">
  <h3 class="signature first" id="current_user-instance_method">
  
    #<strong>current_user</strong>  &#x21d2; <tt>Object</tt>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns the value of attribute current_user</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


53
54
55</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/application_controller.rb', line 53</span>

<span class='kw'>def</span> <span class='id identifier rubyid_current_user'>current_user</span>
  <span class='ivar'>@current_user</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>


  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="after_sign_in_path_for-instance_method">
  
    #<strong>after_sign_in_path_for</strong>(resourse)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>This hook will be called by Devise after successful Facebook login.</p>

<p>Return path where you want the user to be redirected to.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


405
406
407
408
409
410
411
412
413
414
415
416</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/application_controller.rb', line 405</span>

<span class='kw'>def</span> <span class='id identifier rubyid_after_sign_in_path_for'>after_sign_in_path_for</span><span class='lparen'>(</span><span class='id identifier rubyid_resourse'>resourse</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_return_to_path'>return_to_path</span> <span class='op'>=</span> <span class='id identifier rubyid_session'>session</span><span class='lbracket'>[</span><span class='symbol'>:return_to</span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='id identifier rubyid_session'>session</span><span class='lbracket'>[</span><span class='symbol'>:return_to_content</span><span class='rbracket'>]</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_return_to_path'>return_to_path</span>
    <span class='id identifier rubyid_flash'>flash</span><span class='lbracket'>[</span><span class='symbol'>:notice</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_flash'>flash</span><span class='period'>.</span><span class='id identifier rubyid_alert'>alert</span> <span class='kw'>if</span> <span class='id identifier rubyid_flash'>flash</span><span class='period'>.</span><span class='id identifier rubyid_alert'>alert</span> <span class='comment'># Devise sets flash.alert in case already logged in
</span>    <span class='id identifier rubyid_session'>session</span><span class='lbracket'>[</span><span class='symbol'>:return_to</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='kw'>nil</span>
    <span class='id identifier rubyid_session'>session</span><span class='lbracket'>[</span><span class='symbol'>:return_to_content</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='kw'>nil</span>
    <span class='id identifier rubyid_return_to_path'>return_to_path</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_search_path'><span class='object_link'><a href="ApplicationHelper.html#search_path-instance_method" title="ApplicationHelper#search_path (method)">search_path</a></span></span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="cannot_access_if_banned-instance_method">
  
    #<strong>cannot_access_if_banned</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


324
325
326
327
328
329
330
331
332
333
334
335
336</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/application_controller.rb', line 324</span>

<span class='kw'>def</span> <span class='id identifier rubyid_cannot_access_if_banned'>cannot_access_if_banned</span>
  <span class='comment'># Not logged in
</span>  <span class='kw'>return</span> <span class='kw'>unless</span> <span class='ivar'>@current_user</span>

  <span class='comment'># Admin can access
</span>  <span class='kw'>return</span> <span class='kw'>if</span> <span class='ivar'>@current_user</span><span class='period'>.</span><span class='id identifier rubyid_is_admin?'>is_admin?</span>

  <span class='comment'># Check if banned
</span>  <span class='kw'>if</span> <span class='ivar'>@current_user</span><span class='period'>.</span><span class='id identifier rubyid_banned?'>banned?</span>
    <span class='id identifier rubyid_flash'>flash</span><span class='period'>.</span><span class='id identifier rubyid_keep'>keep</span>
    <span class='id identifier rubyid_redirect_to'>redirect_to</span> <span class='id identifier rubyid_access_denied_path'>access_denied_path</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="cannot_access_without_confirmation-instance_method">
  
    #<strong>cannot_access_without_confirmation</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


338
339
340
341
342
343
344
345
346
347
348
349
350
351
352
353
354
355
356
357
358</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/application_controller.rb', line 338</span>

<span class='kw'>def</span> <span class='id identifier rubyid_cannot_access_without_confirmation'>cannot_access_without_confirmation</span>
  <span class='comment'># Not logged in
</span>  <span class='kw'>return</span> <span class='kw'>unless</span> <span class='ivar'>@current_user</span>

  <span class='comment'># Admin can access
</span>  <span class='kw'>return</span> <span class='kw'>if</span> <span class='ivar'>@current_user</span><span class='period'>.</span><span class='id identifier rubyid_is_admin?'>is_admin?</span>

  <span class='kw'>if</span> <span class='ivar'>@current_user</span><span class='period'>.</span><span class='id identifier rubyid_community_membership'>community_membership</span><span class='period'>.</span><span class='id identifier rubyid_pending_email_confirmation?'>pending_email_confirmation?</span>
    <span class='comment'># Check if requirements are already filled, but the membership just hasn&#39;t been updated yet
</span>    <span class='comment'># (This might happen if unexpected error happens during page load and it shouldn&#39;t leave people in loop of of
</span>    <span class='comment'># having email confirmed but not the membership)
</span>    <span class='comment'>#
</span>    <span class='comment'># TODO Remove this. Find the issue that causes this and fix it, don&#39;t fix the symptoms.
</span>    <span class='kw'>if</span> <span class='ivar'>@current_user</span><span class='period'>.</span><span class='id identifier rubyid_has_valid_email_for_community?'>has_valid_email_for_community?</span><span class='lparen'>(</span><span class='ivar'>@current_community</span><span class='rparen'>)</span>
      <span class='ivar'>@current_community</span><span class='period'>.</span><span class='id identifier rubyid_approve_pending_membership'>approve_pending_membership</span><span class='lparen'>(</span><span class='ivar'>@current_user</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_redirect_to'>redirect_to</span> <span class='id identifier rubyid_search_path'><span class='object_link'><a href="ApplicationHelper.html#search_path-instance_method" title="ApplicationHelper#search_path (method)">search_path</a></span></span> <span class='kw'>and</span> <span class='kw'>return</span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_redirect_to'>redirect_to</span> <span class='id identifier rubyid_confirmation_pending_path'>confirmation_pending_path</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="current_user?-instance_method">
  
    #<strong>current_user?</strong>(person)  &#x21d2; <tt>Boolean</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


254
255
256</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/application_controller.rb', line 254</span>

<span class='kw'>def</span> <span class='id identifier rubyid_current_user?'>current_user?</span><span class='lparen'>(</span><span class='id identifier rubyid_person'>person</span><span class='rparen'>)</span>
  <span class='ivar'>@current_user</span> <span class='op'>&amp;&amp;</span> <span class='ivar'>@current_user</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='period'>.</span><span class='id identifier rubyid_eql?'>eql?</span><span class='lparen'>(</span><span class='id identifier rubyid_person'>person</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="ensure_consent_given-instance_method">
  
    #<strong>ensure_consent_given</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Ensure that user accepts terms of community and has a valid email</p>

<p>When user is created through Facebook, terms are not yet accepted and email address might not be validated if addresses are limited for current community. This filter ensures that user takes these actions.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


185
186
187
188
189
190
191
192
193
194
195</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/application_controller.rb', line 185</span>

<span class='kw'>def</span> <span class='id identifier rubyid_ensure_consent_given'>ensure_consent_given</span>
  <span class='comment'># Not logged in
</span>  <span class='kw'>return</span> <span class='kw'>unless</span> <span class='ivar'>@current_user</span>

  <span class='comment'># Admin can access
</span>  <span class='kw'>return</span> <span class='kw'>if</span> <span class='ivar'>@current_user</span><span class='period'>.</span><span class='id identifier rubyid_is_admin?'>is_admin?</span>

  <span class='kw'>if</span> <span class='ivar'>@current_user</span><span class='period'>.</span><span class='id identifier rubyid_community_membership'>community_membership</span><span class='period'>.</span><span class='id identifier rubyid_pending_consent?'>pending_consent?</span>
    <span class='id identifier rubyid_redirect_to'>redirect_to</span> <span class='id identifier rubyid_pending_consent_path'>pending_consent_path</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="ensure_logged_in-instance_method">
  
    #<strong>ensure_logged_in</strong>(warning_message)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>A before filter for views that only users that are logged in can access</p>

<p>Takes one parameter: A warning message that will be displayed in flash notification</p>

<p>Sets the `return_to` variable to session, so that we can redirect user back to this location after the user signed up.</p>

<p>Returns true if user is logged in, false otherwise</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


238
239
240
241
242
243
244
245
246
247
248</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/application_controller.rb', line 238</span>

<span class='kw'>def</span> <span class='id identifier rubyid_ensure_logged_in'>ensure_logged_in</span><span class='lparen'>(</span><span class='id identifier rubyid_warning_message'>warning_message</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_logged_in?'>logged_in?</span>
    <span class='kw'>true</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_session'>session</span><span class='lbracket'>[</span><span class='symbol'>:return_to</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_fullpath'>fullpath</span>
    <span class='id identifier rubyid_flash'>flash</span><span class='lbracket'>[</span><span class='symbol'>:warning</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_warning_message'>warning_message</span>
    <span class='id identifier rubyid_redirect_to'>redirect_to</span> <span class='id identifier rubyid_login_path'>login_path</span>

    <span class='kw'>false</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="ensure_user_belongs_to_community-instance_method">
  
    #<strong>ensure_user_belongs_to_community</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Ensure that user belongs to community</p>

<p>This check is in most cases useless: When user logs in we already check that the user belongs to the community she is trying to log in. However, after the user account separation migration in March 2016, there was a possibility that user had an existing session which pointed to a person_id that belonged to another community. That&#39;s why we need to check the community membership even after logging in.</p>

<p>This extra check can be removed when we are sure that all the sessions which potentially had a person_id pointing to another community are all expired.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/application_controller.rb', line 210</span>

<span class='kw'>def</span> <span class='id identifier rubyid_ensure_user_belongs_to_community'>ensure_user_belongs_to_community</span>
  <span class='kw'>return</span> <span class='kw'>unless</span> <span class='ivar'>@current_user</span>

  <span class='kw'>if</span> <span class='op'>!</span><span class='ivar'>@current_user</span><span class='period'>.</span><span class='id identifier rubyid_has_admin_rights?'>has_admin_rights?</span><span class='lparen'>(</span><span class='ivar'>@current_community</span><span class='rparen'>)</span> <span class='op'>&amp;&amp;</span> <span class='ivar'>@current_user</span><span class='period'>.</span><span class='id identifier rubyid_accepted_community'>accepted_community</span> <span class='op'>!=</span> <span class='ivar'>@current_community</span>

    <span class='id identifier rubyid_logger'>logger</span><span class='period'>.</span><span class='id identifier rubyid_info'>info</span><span class='lparen'>(</span>
      <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Automatically logged out user that doesn&#39;t belong to community</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
      <span class='symbol'>:autologout</span><span class='comma'>,</span>
      <span class='label'>current_user_id:</span> <span class='ivar'>@current_user</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span>
      <span class='label'>current_community_id:</span> <span class='ivar'>@current_community</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span>
      <span class='label'>current_user_community_ids:</span> <span class='ivar'>@current_user</span><span class='period'>.</span><span class='id identifier rubyid_communities'>communities</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:id</span><span class='rparen'>)</span>
    <span class='rparen'>)</span>

    <span class='id identifier rubyid_sign_out'>sign_out</span>
    <span class='id identifier rubyid_flash'>flash</span><span class='lbracket'>[</span><span class='symbol'>:notice</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_t'>t</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>layouts.notifications.automatically_logged_out_please_sign_in</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>

    <span class='id identifier rubyid_redirect_to'>redirect_to</span> <span class='id identifier rubyid_search_path'><span class='object_link'><a href="ApplicationHelper.html#search_path-instance_method" title="ApplicationHelper#search_path (method)">search_path</a></span></span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="fetch_community-instance_method">
  
    #<strong>fetch_community</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Before filter to get the current community</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


276
277
278
279
280
281
282
283
284
285</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/application_controller.rb', line 276</span>

<span class='kw'>def</span> <span class='id identifier rubyid_fetch_community'>fetch_community</span>
  <span class='ivar'>@current_community</span> <span class='op'>=</span> <span class='id identifier rubyid_resolve_community'>resolve_community</span><span class='lparen'>(</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_m_community'>m_community</span> <span class='op'>=</span> <span class='const'>Maybe</span><span class='lparen'>(</span><span class='ivar'>@current_community</span><span class='rparen'>)</span>

  <span class='comment'># Save current community id in request env to be used
</span>  <span class='comment'># by Devise and our custom community authenticatable strategy
</span>  <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_env'>env</span><span class='lbracket'>[</span><span class='symbol'>:community_id</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_m_community'>m_community</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='period'>.</span><span class='id identifier rubyid_or_else'>or_else</span><span class='lparen'>(</span><span class='kw'>nil</span><span class='rparen'>)</span>

  <span class='id identifier rubyid_setup_logger!'>setup_logger!</span><span class='lparen'>(</span><span class='label'>marketplace_id:</span> <span class='id identifier rubyid_m_community'>m_community</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='period'>.</span><span class='id identifier rubyid_or_else'>or_else</span><span class='lparen'>(</span><span class='kw'>nil</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='label'>marketplace_ident:</span> <span class='id identifier rubyid_m_community'>m_community</span><span class='period'>.</span><span class='id identifier rubyid_ident'>ident</span><span class='period'>.</span><span class='id identifier rubyid_or_else'>or_else</span><span class='lparen'>(</span><span class='kw'>nil</span><span class='rparen'>)</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="fetch_community_admin_status-instance_method">
  
    #<strong>fetch_community_admin_status</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


360
361
362</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/application_controller.rb', line 360</span>

<span class='kw'>def</span> <span class='id identifier rubyid_fetch_community_admin_status'>fetch_community_admin_status</span>
  <span class='ivar'>@is_current_community_admin</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='ivar'>@current_user</span><span class='op'>&amp;.</span><span class='id identifier rubyid_has_admin_rights?'>has_admin_rights?</span><span class='lparen'>(</span><span class='ivar'>@current_community</span><span class='rparen'>)</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="fetch_community_membership-instance_method">
  
    #<strong>fetch_community_membership</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


314
315
316
317
318
319
320
321
322</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/application_controller.rb', line 314</span>

<span class='kw'>def</span> <span class='id identifier rubyid_fetch_community_membership'>fetch_community_membership</span>
  <span class='kw'>if</span> <span class='ivar'>@current_user</span>
    <span class='ivar'>@current_community_membership</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="CommunityMembership.html" title="CommunityMembership (class)">CommunityMembership</a></span></span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='label'>person_id:</span> <span class='ivar'>@current_user</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='label'>community_id:</span> <span class='ivar'>@current_community</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='label'>status:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>accepted</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span>

    <span class='kw'>if</span> <span class='lparen'>(</span><span class='ivar'>@current_community_membership</span> <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='id identifier rubyid_date_equals?'>date_equals?</span><span class='lparen'>(</span><span class='ivar'>@current_community_membership</span><span class='period'>.</span><span class='id identifier rubyid_last_page_load_date'>last_page_load_date</span><span class='comma'>,</span> <span class='const'>Date</span><span class='period'>.</span><span class='id identifier rubyid_today'>today</span><span class='rparen'>)</span><span class='rparen'>)</span>
      <span class='const'>Delayed</span><span class='op'>::</span><span class='const'>Job</span><span class='period'>.</span><span class='id identifier rubyid_enqueue'>enqueue</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="PageLoadedJob.html" title="PageLoadedJob (class)">PageLoadedJob</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='ivar'>@current_community_membership</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_host'>host</span><span class='rparen'>)</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="fetch_community_plan_expiration_status-instance_method">
  
    #<strong>fetch_community_plan_expiration_status</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


364
365
366</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/application_controller.rb', line 364</span>

<span class='kw'>def</span> <span class='id identifier rubyid_fetch_community_plan_expiration_status'>fetch_community_plan_expiration_status</span>
  <span class='ivar'>@current_plan</span> <span class='op'>=</span> <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_env'>env</span><span class='lbracket'>[</span><span class='symbol'>:current_plan</span><span class='rbracket'>]</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="fetch_logged_in_user-instance_method">
  
    #<strong>fetch_logged_in_user</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


160
161
162
163
164
165</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/application_controller.rb', line 160</span>

<span class='kw'>def</span> <span class='id identifier rubyid_fetch_logged_in_user'>fetch_logged_in_user</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_person_signed_in?'>person_signed_in?</span>
    <span class='ivar'>@current_user</span> <span class='op'>=</span> <span class='id identifier rubyid_current_person'>current_person</span>
    <span class='id identifier rubyid_setup_logger!'>setup_logger!</span><span class='lparen'>(</span><span class='label'>user_id:</span> <span class='ivar'>@current_user</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='label'>username:</span> <span class='ivar'>@current_user</span><span class='period'>.</span><span class='id identifier rubyid_username'>username</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="initialize_feature_flags-instance_method">
  
    #<strong>initialize_feature_flags</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


167
168
169
170
171
172
173
174
175
176
177</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/application_controller.rb', line 167</span>

<span class='kw'>def</span> <span class='id identifier rubyid_initialize_feature_flags'>initialize_feature_flags</span>
  <span class='comment'># Skip this if there is no current marketplace.
</span>  <span class='comment'># This allows to avoid skipping this filter in many places.
</span>  <span class='kw'>return</span> <span class='kw'>unless</span> <span class='ivar'>@current_community</span>

  <span class='const'><span class='object_link'><a href="FeatureFlagHelper.html" title="FeatureFlagHelper (module)">FeatureFlagHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_init'><span class='object_link'><a href="FeatureFlagHelper.html#init-class_method" title="FeatureFlagHelper.init (method)">init</a></span></span><span class='lparen'>(</span><span class='label'>community_id:</span> <span class='ivar'>@current_community</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span>
                         <span class='label'>user_id:</span> <span class='ivar'>@current_user</span><span class='op'>&amp;.</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span>
                         <span class='label'>request:</span> <span class='id identifier rubyid_request'>request</span><span class='comma'>,</span>
                         <span class='label'>is_admin:</span> <span class='const'>Maybe</span><span class='lparen'>(</span><span class='ivar'>@current_user</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_is_admin?'>is_admin?</span><span class='period'>.</span><span class='id identifier rubyid_or_else'>or_else</span><span class='lparen'>(</span><span class='kw'>false</span><span class='rparen'>)</span><span class='comma'>,</span>
                         <span class='label'>is_marketplace_admin:</span> <span class='const'>Maybe</span><span class='lparen'>(</span><span class='ivar'>@current_user</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_is_marketplace_admin?'>is_marketplace_admin?</span><span class='lparen'>(</span><span class='ivar'>@current_community</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_or_else'>or_else</span><span class='lparen'>(</span><span class='kw'>false</span><span class='rparen'>)</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="logged_in?-instance_method">
  
    #<strong>logged_in?</strong>  &#x21d2; <tt>Boolean</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


250
251
252</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/application_controller.rb', line 250</span>

<span class='kw'>def</span> <span class='id identifier rubyid_logged_in?'>logged_in?</span>
  <span class='ivar'>@current_user</span><span class='period'>.</span><span class='id identifier rubyid_present?'>present?</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="maintenance_warning-instance_method">
  
    #<strong>maintenance_warning</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


394
395
396
397
398</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/application_controller.rb', line 394</span>

<span class='kw'>def</span> <span class='id identifier rubyid_maintenance_warning'>maintenance_warning</span>
  <span class='id identifier rubyid_now'>now</span> <span class='op'>=</span> <span class='const'>Time</span><span class='period'>.</span><span class='id identifier rubyid_now'>now</span>
  <span class='ivar'>@show_maintenance_warning</span> <span class='op'>=</span> <span class='const'>NextMaintenance</span><span class='period'>.</span><span class='id identifier rubyid_show_warning?'>show_warning?</span><span class='lparen'>(</span><span class='int'>15</span><span class='period'>.</span><span class='id identifier rubyid_minutes'>minutes</span><span class='comma'>,</span> <span class='id identifier rubyid_now'>now</span><span class='rparen'>)</span>
  <span class='ivar'>@minutes_to_maintenance</span> <span class='op'>=</span> <span class='const'>NextMaintenance</span><span class='period'>.</span><span class='id identifier rubyid_minutes_to'>minutes_to</span><span class='lparen'>(</span><span class='id identifier rubyid_now'>now</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="not_available-instance_method">
  
    #<strong>not_available</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>plain stub for routes, intercepted in perfom_redirect</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


310
311
312</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/application_controller.rb', line 310</span>

<span class='kw'>def</span> <span class='id identifier rubyid_not_available'>not_available</span>
  <span class='id identifier rubyid_render'>render</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>errors/community_not_found</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='label'>layout:</span> <span class='kw'>false</span><span class='comma'>,</span> <span class='label'>status:</span> <span class='symbol'>:not_found</span><span class='comma'>,</span> <span class='label'>locals:</span> <span class='lbrace'>{</span> <span class='label'>status:</span> <span class='int'>404</span><span class='comma'>,</span> <span class='label'>title:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Marketplace not found</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>host:</span> <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_host'>host</span> <span class='rbrace'>}</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="perform_redirect-instance_method">
  
    #<strong>perform_redirect</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Performs redirect to correct URL, if needed. Note: This filter is safe to run even if :fetch_community filter is skipped</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/application_controller.rb', line 290</span>

<span class='kw'>def</span> <span class='id identifier rubyid_perform_redirect'>perform_redirect</span>
  <span class='id identifier rubyid_redirect_params'>redirect_params</span> <span class='op'>=</span> <span class='lbrace'>{</span>
    <span class='label'>community:</span> <span class='ivar'>@current_community</span><span class='comma'>,</span>
    <span class='label'>plan:</span> <span class='ivar'>@current_plan</span><span class='comma'>,</span>
    <span class='label'>request:</span> <span class='id identifier rubyid_request'>request</span>
  <span class='rbrace'>}</span>

  <span class='const'><span class='object_link'><a href="MarketplaceRouter.html" title="MarketplaceRouter (module)">MarketplaceRouter</a></span></span><span class='period'>.</span><span class='id identifier rubyid_perform_redirect'><span class='object_link'><a href="MarketplaceRouter.html#perform_redirect-class_method" title="MarketplaceRouter.perform_redirect (method)">perform_redirect</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_redirect_params'>redirect_params</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_target'>target</span><span class='op'>|</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_target'>target</span><span class='lbracket'>[</span><span class='symbol'>:message</span><span class='rbracket'>]</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:action</span><span class='rbracket'>]</span> <span class='op'>!=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>not_available</span><span class='tstring_end'>&#39;</span></span>
      <span class='id identifier rubyid_redirect_to'>redirect_to</span> <span class='id identifier rubyid_community_not_available_path'>community_not_available_path</span>
    <span class='kw'>elsif</span> <span class='id identifier rubyid_target'>target</span><span class='lbracket'>[</span><span class='symbol'>:message</span><span class='rbracket'>]</span>
      <span class='id identifier rubyid_render'>render</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>layouts/marketplace_router_error</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='label'>layout:</span> <span class='kw'>false</span><span class='comma'>,</span> <span class='label'>locals:</span> <span class='lbrace'>{</span><span class='label'>message:</span> <span class='id identifier rubyid_target'>target</span><span class='lbracket'>[</span><span class='symbol'>:message</span><span class='rbracket'>]</span><span class='rbrace'>}</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_url'>url</span> <span class='op'>=</span> <span class='id identifier rubyid_target'>target</span><span class='lbracket'>[</span><span class='symbol'>:url</span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='id identifier rubyid_send'>send</span><span class='lparen'>(</span><span class='id identifier rubyid_target'>target</span><span class='lbracket'>[</span><span class='symbol'>:route_name</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='label'>protocol:</span> <span class='id identifier rubyid_target'>target</span><span class='lbracket'>[</span><span class='symbol'>:protocol</span><span class='rbracket'>]</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_redirect_to'>redirect_to</span><span class='lparen'>(</span><span class='id identifier rubyid_url'>url</span><span class='comma'>,</span> <span class='label'>status:</span> <span class='id identifier rubyid_target'>target</span><span class='lbracket'>[</span><span class='symbol'>:status</span><span class='rbracket'>]</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="redirect_locale_param-instance_method">
  
    #<strong>redirect_locale_param</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>If URL contains locale parameter that doesn&#39;t match with the selected locale, redirect to the selected locale</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


140
141
142
143
144</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/application_controller.rb', line 140</span>

<span class='kw'>def</span> <span class='id identifier rubyid_redirect_locale_param'>redirect_locale_param</span>
  <span class='id identifier rubyid_param_locale_not_selected'>param_locale_not_selected</span> <span class='op'>=</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:locale</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_present?'>present?</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:locale</span><span class='rbracket'>]</span> <span class='op'>!=</span> <span class='const'>I18n</span><span class='period'>.</span><span class='id identifier rubyid_locale'>locale</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span>

  <span class='id identifier rubyid_redirect_to_locale'>redirect_to_locale</span><span class='lparen'>(</span><span class='const'>I18n</span><span class='period'>.</span><span class='id identifier rubyid_locale'>locale</span><span class='comma'>,</span> <span class='symbol'>:temporary_redirect</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_param_locale_not_selected'>param_locale_not_selected</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="redirect_removed_locale-instance_method">
  
    #<strong>redirect_removed_locale</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


55
56
57
58
59
60</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/application_controller.rb', line 55</span>

<span class='kw'>def</span> <span class='id identifier rubyid_redirect_removed_locale'>redirect_removed_locale</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:locale</span><span class='rbracket'>]</span> <span class='op'>&amp;&amp;</span> <span class='const'>Rails</span><span class='period'>.</span><span class='id identifier rubyid_application'>application</span><span class='period'>.</span><span class='id identifier rubyid_config'>config</span><span class='period'>.</span><span class='const'>REMOVED_LOCALES</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:locale</span><span class='rbracket'>]</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_fallback'>fallback</span> <span class='op'>=</span> <span class='const'>Rails</span><span class='period'>.</span><span class='id identifier rubyid_application'>application</span><span class='period'>.</span><span class='id identifier rubyid_config'>config</span><span class='period'>.</span><span class='const'>REMOVED_LOCALE_FALLBACKS</span><span class='lbracket'>[</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:locale</span><span class='rbracket'>]</span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_redirect_to_locale'>redirect_to_locale</span><span class='lparen'>(</span><span class='id identifier rubyid_fallback'>fallback</span><span class='comma'>,</span> <span class='symbol'>:moved_permanently</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="redirect_to_locale-instance_method">
  
    #<strong>redirect_to_locale</strong>(new_locale, status)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


146
147
148
149
150
151
152</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/application_controller.rb', line 146</span>

<span class='kw'>def</span> <span class='id identifier rubyid_redirect_to_locale'>redirect_to_locale</span><span class='lparen'>(</span><span class='id identifier rubyid_new_locale'>new_locale</span><span class='comma'>,</span> <span class='id identifier rubyid_status'>status</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='ivar'>@current_community</span><span class='period'>.</span><span class='id identifier rubyid_default_locale'>default_locale</span> <span class='op'>==</span> <span class='id identifier rubyid_new_locale'>new_locale</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span>
    <span class='id identifier rubyid_redirect_to'>redirect_to</span> <span class='id identifier rubyid_url_for'>url_for</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='period'>.</span><span class='id identifier rubyid_to_unsafe_hash'>to_unsafe_hash</span><span class='period'>.</span><span class='id identifier rubyid_symbolize_keys'>symbolize_keys</span><span class='period'>.</span><span class='id identifier rubyid_except'>except</span><span class='lparen'>(</span><span class='symbol'>:locale</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_merge'>merge</span><span class='lparen'>(</span><span class='label'>only_path:</span> <span class='kw'>true</span><span class='rparen'>)</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='symbol'>:status</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_status'>status</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_redirect_to'>redirect_to</span> <span class='id identifier rubyid_url_for'>url_for</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='period'>.</span><span class='id identifier rubyid_to_unsafe_hash'>to_unsafe_hash</span><span class='period'>.</span><span class='id identifier rubyid_symbolize_keys'>symbolize_keys</span><span class='period'>.</span><span class='id identifier rubyid_merge'>merge</span><span class='lparen'>(</span><span class='label'>locale:</span> <span class='id identifier rubyid_new_locale'>new_locale</span><span class='comma'>,</span> <span class='label'>only_path:</span> <span class='kw'>true</span><span class='rparen'>)</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='symbol'>:status</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_status'>status</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="resolve_community-instance_method">
  
    #<strong>resolve_community</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>This can be overriden by controllers, if they have another strategy for resolving the community</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


271
272
273</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/application_controller.rb', line 271</span>

<span class='kw'>def</span> <span class='id identifier rubyid_resolve_community'>resolve_community</span>
  <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_env'>env</span><span class='lbracket'>[</span><span class='symbol'>:current_marketplace</span><span class='rbracket'>]</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="root-instance_method">
  
    #<strong>root</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Creates a URL for root path (i18n breaks root_path helper)</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


155
156
157
158</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/application_controller.rb', line 155</span>

<span class='kw'>def</span> <span class='id identifier rubyid_root'><span class='object_link'><a href="top-level-namespace.html" title="Top Level Namespace (root)">root</a></span></span>
  <span class='const'>ActiveSupport</span><span class='op'>::</span><span class='const'>Deprecation</span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Call to root is deprecated and will be removed in the future. Use search_path or landing_page_path instead.</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_protocol'>protocol</span><span class='embexpr_end'>}</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_host_with_port'>host_with_port</span><span class='embexpr_end'>}</span><span class='tstring_content'>/</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:locale</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="save_current_host_with_port-instance_method">
  
    #<strong>save_current_host_with_port</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


264
265
266
267</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/application_controller.rb', line 264</span>

<span class='kw'>def</span> <span class='id identifier rubyid_save_current_host_with_port'>save_current_host_with_port</span>
  <span class='comment'># store the host of the current request (as sometimes needed in views)
</span>  <span class='ivar'>@current_host_with_port</span> <span class='op'>=</span> <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_host_with_port'>host_with_port</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="save_current_path-instance_method">
  
    #<strong>save_current_path</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Saves current path so that the user can be redirected back to that path when needed.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


260
261
262</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/application_controller.rb', line 260</span>

<span class='kw'>def</span> <span class='id identifier rubyid_save_current_path'>save_current_path</span>
  <span class='id identifier rubyid_session'>session</span><span class='lbracket'>[</span><span class='symbol'>:return_to_content</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_fullpath'>fullpath</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="set_display_expiration_notice-instance_method">
  
    #<strong>set_display_expiration_notice</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


418
419
420
421
422
423</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/application_controller.rb', line 418</span>

<span class='kw'>def</span> <span class='id identifier rubyid_set_display_expiration_notice'>set_display_expiration_notice</span>
  <span class='id identifier rubyid_ext_service_active'>ext_service_active</span> <span class='op'>=</span> <span class='const'>PlanService</span><span class='op'>::</span><span class='const'>API</span><span class='op'>::</span><span class='const'>Api</span><span class='period'>.</span><span class='id identifier rubyid_plans'>plans</span><span class='period'>.</span><span class='id identifier rubyid_active?'>active?</span>
  <span class='id identifier rubyid_is_expired'>is_expired</span> <span class='op'>=</span> <span class='const'>Maybe</span><span class='lparen'>(</span><span class='ivar'>@current_plan</span><span class='rparen'>)</span><span class='lbracket'>[</span><span class='symbol'>:expired</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_or_else'>or_else</span><span class='lparen'>(</span><span class='kw'>false</span><span class='rparen'>)</span>

  <span class='ivar'>@display_expiration_notice</span> <span class='op'>=</span> <span class='id identifier rubyid_ext_service_active'>ext_service_active</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_is_expired'>is_expired</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="set_homepage_path-instance_method">
  
    #<strong>set_homepage_path</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/application_controller.rb', line 110</span>

<span class='kw'>def</span> <span class='id identifier rubyid_set_homepage_path'>set_homepage_path</span>
  <span class='id identifier rubyid_present'>present</span> <span class='op'>=</span> <span class='tlambda'>-&gt;</span><span class='lparen'>(</span><span class='id identifier rubyid_x'>x</span><span class='rparen'>)</span> <span class='tlambeg'>{</span> <span class='id identifier rubyid_x'>x</span><span class='period'>.</span><span class='id identifier rubyid_present?'>present?</span> <span class='rbrace'>}</span>

  <span class='ivar'>@homepage_path</span> <span class='op'>=</span>
    <span class='kw'>case</span> <span class='lbracket'>[</span><span class='ivar'>@current_community</span><span class='comma'>,</span> <span class='ivar'>@current_user</span><span class='comma'>,</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:locale</span><span class='rbracket'>]</span><span class='rbracket'>]</span>
    <span class='kw'>when</span> <span class='id identifier rubyid_matches'><span class='object_link'><a href="top-level-namespace.html#matches-instance_method" title="#matches (method)">matches</a></span></span><span class='lparen'>(</span><span class='lbracket'>[</span><span class='kw'>nil</span><span class='comma'>,</span> <span class='id identifier rubyid___'><span class='object_link'><a href="top-level-namespace.html#__-instance_method" title="#__ (method)">__</a></span></span><span class='comma'>,</span> <span class='id identifier rubyid___'><span class='object_link'><a href="top-level-namespace.html#__-instance_method" title="#__ (method)">__</a></span></span><span class='rbracket'>]</span><span class='rparen'>)</span>
      <span class='comment'># FIXME We still have controllers that inherit application controller even though
</span>      <span class='comment'># they do not have @current_community
</span>      <span class='comment'>#
</span>      <span class='comment'># Return nil, do nothing, but don&#39;t break
</span>      <span class='kw'>nil</span>

    <span class='kw'>when</span> <span class='id identifier rubyid_matches'><span class='object_link'><a href="top-level-namespace.html#matches-instance_method" title="#matches (method)">matches</a></span></span><span class='lparen'>(</span><span class='lbracket'>[</span><span class='id identifier rubyid_present'>present</span><span class='comma'>,</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='id identifier rubyid_present'>present</span><span class='rbracket'>]</span><span class='rparen'>)</span>
      <span class='comment'># We don&#39;t have @current_user.
</span>      <span class='comment'># Take the locale from URL param, and keep it in the URL if the locale
</span>      <span class='comment'># differs from community default
</span>      <span class='kw'>if</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:locale</span><span class='rbracket'>]</span> <span class='op'>!=</span> <span class='ivar'>@current_community</span><span class='period'>.</span><span class='id identifier rubyid_default_locale'>default_locale</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span>
        <span class='id identifier rubyid_homepage_with_locale_path'>homepage_with_locale_path</span>
      <span class='kw'>else</span>
        <span class='id identifier rubyid_homepage_without_locale_path'>homepage_without_locale_path</span><span class='lparen'>(</span><span class='label'>locale:</span> <span class='kw'>nil</span><span class='rparen'>)</span>
      <span class='kw'>end</span>

    <span class='kw'>else</span>
      <span class='id identifier rubyid_homepage_without_locale_path'>homepage_without_locale_path</span><span class='lparen'>(</span><span class='label'>locale:</span> <span class='kw'>nil</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="set_locale-instance_method">
  
    #<strong>set_locale</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt>ArgumentError</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/application_controller.rb', line 62</span>

<span class='kw'>def</span> <span class='id identifier rubyid_set_locale'>set_locale</span>
  <span class='id identifier rubyid_user_locale'>user_locale</span> <span class='op'>=</span> <span class='const'>Maybe</span><span class='lparen'>(</span><span class='ivar'>@current_user</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_locale'>locale</span><span class='period'>.</span><span class='id identifier rubyid_or_else'>or_else</span><span class='lparen'>(</span><span class='kw'>nil</span><span class='rparen'>)</span>

  <span class='comment'># We should fix this -- START
</span>  <span class='comment'>#
</span>  <span class='comment'># There are a couple of controllers (amazon ses bounces, etc.) that
</span>  <span class='comment'># inherit application controller, even though they shouldn&#39;t. ApplicationController
</span>  <span class='comment'># has a lot of community specific filters and those controllers do not have community.
</span>  <span class='comment'># Thus, we need to add this kind of additional logic to make sure whether we have
</span>  <span class='comment'># community or not
</span>  <span class='comment'>#
</span>  <span class='id identifier rubyid_m_community'>m_community</span> <span class='op'>=</span> <span class='const'>Maybe</span><span class='lparen'>(</span><span class='ivar'>@current_community</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_community_locales'>community_locales</span> <span class='op'>=</span> <span class='id identifier rubyid_m_community'>m_community</span><span class='period'>.</span><span class='id identifier rubyid_locales'>locales</span><span class='period'>.</span><span class='id identifier rubyid_or_else'>or_else</span><span class='lparen'>(</span><span class='lbracket'>[</span><span class='rbracket'>]</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_community_default_locale'>community_default_locale</span> <span class='op'>=</span> <span class='id identifier rubyid_m_community'>m_community</span><span class='period'>.</span><span class='id identifier rubyid_default_locale'>default_locale</span><span class='period'>.</span><span class='id identifier rubyid_or_else'>or_else</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>en</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='id identifier rubyid_community_id'>community_id</span> <span class='op'>=</span> <span class='id identifier rubyid_m_community'>m_community</span><span class='lbracket'>[</span><span class='symbol'>:id</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_or_else'>or_else</span><span class='lparen'>(</span><span class='kw'>nil</span><span class='rparen'>)</span>

  <span class='const'><span class='object_link'><a href="I18nHelper.html" title="I18nHelper (module)">I18nHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_initialize_community_backend!'><span class='object_link'><a href="I18nHelper.html#initialize_community_backend!-class_method" title="I18nHelper.initialize_community_backend! (method)">initialize_community_backend!</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_community_id'>community_id</span><span class='comma'>,</span> <span class='id identifier rubyid_community_locales'>community_locales</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_community_id'>community_id</span>

  <span class='comment'># We should fix this -- END
</span>
  <span class='id identifier rubyid_locale'>locale</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="I18nHelper.html" title="I18nHelper (module)">I18nHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_select_locale'><span class='object_link'><a href="I18nHelper.html#select_locale-class_method" title="I18nHelper.select_locale (method)">select_locale</a></span></span><span class='lparen'>(</span>
    <span class='label'>user_locale:</span> <span class='id identifier rubyid_user_locale'>user_locale</span><span class='comma'>,</span>
    <span class='label'>param_locale:</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:locale</span><span class='rbracket'>]</span><span class='comma'>,</span>
    <span class='label'>community_locales:</span> <span class='id identifier rubyid_community_locales'>community_locales</span><span class='comma'>,</span>
    <span class='label'>community_default:</span> <span class='id identifier rubyid_community_default_locale'>community_default_locale</span><span class='comma'>,</span>
    <span class='label'>all_locales:</span> <span class='const'>Sharetribe</span><span class='op'>::</span><span class='const'>AVAILABLE_LOCALES</span>
  <span class='rparen'>)</span>

  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Locale </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_locale'>locale</span><span class='embexpr_end'>}</span><span class='tstring_content'> not available. Check your community settings</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>unless</span> <span class='id identifier rubyid_available_locales'><span class='object_link'><a href="ApplicationHelper.html#available_locales-instance_method" title="ApplicationHelper#available_locales (method)">available_locales</a></span></span><span class='period'>.</span><span class='id identifier rubyid_collect'>collect</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_l'>l</span><span class='op'>|</span> <span class='id identifier rubyid_l'>l</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span> <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_locale'>locale</span><span class='rparen'>)</span>

  <span class='const'>I18n</span><span class='period'>.</span><span class='id identifier rubyid_locale'>locale</span> <span class='op'>=</span> <span class='id identifier rubyid_locale'>locale</span>
  <span class='ivar'>@facebook_locale_code</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="I18nHelper.html" title="I18nHelper (module)">I18nHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_facebook_locale_code'><span class='object_link'><a href="I18nHelper.html#facebook_locale_code-class_method" title="I18nHelper.facebook_locale_code (method)">facebook_locale_code</a></span></span><span class='lparen'>(</span><span class='const'>Sharetribe</span><span class='op'>::</span><span class='const'>AVAILABLE_LOCALES</span><span class='comma'>,</span> <span class='id identifier rubyid_locale'>locale</span><span class='rparen'>)</span>

  <span class='comment'># Store to thread the service_name used by current community, so that it can be included in all translations
</span>  <span class='const'><span class='object_link'><a href="ApplicationHelper.html" title="ApplicationHelper (module)">ApplicationHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_store_community_service_name_to_thread'><span class='object_link'><a href="ApplicationHelper.html#store_community_service_name_to_thread-class_method" title="ApplicationHelper.store_community_service_name_to_thread (method)">store_community_service_name_to_thread</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_service_name'><span class='object_link'><a href="ApplicationHelper.html#service_name-instance_method" title="ApplicationHelper#service_name (method)">service_name</a></span></span><span class='rparen'>)</span>

  <span class='comment'># A hack to get the path where the user is
</span>  <span class='comment'># redirected after the locale is changed
</span>  <span class='id identifier rubyid_new_path'>new_path</span> <span class='op'>=</span> <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_fullpath'>fullpath</span><span class='period'>.</span><span class='id identifier rubyid_clone'>clone</span>
  <span class='id identifier rubyid_new_path'>new_path</span><span class='period'>.</span><span class='id identifier rubyid_slice!'>slice!</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:locale</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='id identifier rubyid_new_path'>new_path</span><span class='period'>.</span><span class='id identifier rubyid_slice!'>slice!</span><span class='lparen'>(</span><span class='int'>0</span><span class='comma'>,</span><span class='int'>1</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_new_path'>new_path</span> <span class='op'>=~</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>^\/</span><span class='regexp_end'>/</span></span>
  <span class='ivar'>@return_to</span> <span class='op'>=</span> <span class='id identifier rubyid_new_path'>new_path</span>

  <span class='const'>Maybe</span><span class='lparen'>(</span><span class='ivar'>@current_community</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_community'>community</span><span class='op'>|</span>
    <span class='ivar'>@community_customization</span> <span class='op'>=</span> <span class='id identifier rubyid_community'>community</span><span class='period'>.</span><span class='id identifier rubyid_community_customizations'>community_customizations</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='label'>locale:</span> <span class='id identifier rubyid_locale'>locale</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span>
  <span class='rbrace'>}</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="warn_about_missing_payment_info-instance_method">
  
    #<strong>warn_about_missing_payment_info</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Before filter for payments, shows notification if user is not ready for payments</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


369
370
371
372
373
374
375
376
377
378
379
380
381
382
383
384
385
386
387
388
389
390
391
392</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/application_controller.rb', line 369</span>

<span class='kw'>def</span> <span class='id identifier rubyid_warn_about_missing_payment_info'>warn_about_missing_payment_info</span>
  <span class='kw'>if</span> <span class='ivar'>@current_user</span>
    <span class='id identifier rubyid_has_paid_listings'>has_paid_listings</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="PaymentHelper.html" title="PaymentHelper (module)">PaymentHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_open_listings_with_payment_process?'><span class='object_link'><a href="PaymentHelper.html#open_listings_with_payment_process%3F-class_method" title="PaymentHelper.open_listings_with_payment_process? (method)">open_listings_with_payment_process?</a></span></span><span class='lparen'>(</span><span class='ivar'>@current_community</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='ivar'>@current_user</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_paypal_community'>paypal_community</span>  <span class='op'>=</span> <span class='const'><span class='object_link'><a href="PaypalHelper.html" title="PaypalHelper (module)">PaypalHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_community_ready_for_payments?'><span class='object_link'><a href="PaypalHelper.html#community_ready_for_payments%3F-class_method" title="PaypalHelper.community_ready_for_payments? (method)">community_ready_for_payments?</a></span></span><span class='lparen'>(</span><span class='ivar'>@current_community</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_stripe_community'>stripe_community</span>  <span class='op'>=</span> <span class='const'><span class='object_link'><a href="StripeHelper.html" title="StripeHelper (module)">StripeHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_community_ready_for_payments?'><span class='object_link'><a href="StripeHelper.html#community_ready_for_payments%3F-class_method" title="StripeHelper.community_ready_for_payments? (method)">community_ready_for_payments?</a></span></span><span class='lparen'>(</span><span class='ivar'>@current_community</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_paypal_ready'>paypal_ready</span>      <span class='op'>=</span> <span class='const'><span class='object_link'><a href="PaypalHelper.html" title="PaypalHelper (module)">PaypalHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_account_prepared_for_user?'><span class='object_link'><a href="PaypalHelper.html#account_prepared_for_user%3F-class_method" title="PaypalHelper.account_prepared_for_user? (method)">account_prepared_for_user?</a></span></span><span class='lparen'>(</span><span class='ivar'>@current_user</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='ivar'>@current_community</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_stripe_ready'>stripe_ready</span>      <span class='op'>=</span> <span class='const'><span class='object_link'><a href="StripeHelper.html" title="StripeHelper (module)">StripeHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_user_stripe_active?'><span class='object_link'><a href="StripeHelper.html#user_stripe_active%3F-class_method" title="StripeHelper.user_stripe_active? (method)">user_stripe_active?</a></span></span><span class='lparen'>(</span><span class='ivar'>@current_community</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='ivar'>@current_user</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span>

    <span class='id identifier rubyid_accept_payments'>accept_payments</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_paypal_community'>paypal_community</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_paypal_ready'>paypal_ready</span>
      <span class='id identifier rubyid_accept_payments'>accept_payments</span> <span class='op'>&lt;&lt;</span> <span class='symbol'>:paypal</span>
    <span class='kw'>end</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_stripe_community'>stripe_community</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_stripe_ready'>stripe_ready</span>
      <span class='id identifier rubyid_accept_payments'>accept_payments</span> <span class='op'>&lt;&lt;</span> <span class='symbol'>:stripe</span>
    <span class='kw'>end</span>

    <span class='kw'>if</span> <span class='id identifier rubyid_has_paid_listings'>has_paid_listings</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_accept_payments'>accept_payments</span><span class='period'>.</span><span class='id identifier rubyid_blank?'>blank?</span>
      <span class='id identifier rubyid_payment_settings_link'>payment_settings_link</span> <span class='op'>=</span> <span class='id identifier rubyid_view_context'>view_context</span><span class='period'>.</span><span class='id identifier rubyid_link_to'>link_to</span><span class='lparen'>(</span><span class='id identifier rubyid_t'>t</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>paypal_accounts.from_your_payment_settings_link_text</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='comma'>,</span>
        <span class='id identifier rubyid_person_payment_settings_path'>person_payment_settings_path</span><span class='lparen'>(</span><span class='ivar'>@current_user</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='label'>target:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>_blank</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>rel:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>noopener</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>

      <span class='id identifier rubyid_flash'>flash</span><span class='period'>.</span><span class='id identifier rubyid_now'>now</span><span class='lbracket'>[</span><span class='symbol'>:warning</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_t'>t</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>stripe_accounts.missing_payment</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>settings_link:</span> <span class='id identifier rubyid_payment_settings_link'>payment_settings_link</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_html_safe'>html_safe</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

      <div id="footer">
  Generated on Tue Feb 11 14:02:15 2020 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.19 (ruby-2.6.2).
</div>

    </div>
  </body>
</html>