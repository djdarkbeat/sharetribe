<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Module: CacheHelper
  
    &mdash; Documentation by YARD 0.9.19
  
</title>

  <link rel="stylesheet" href="css/style.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="css/common.css" type="text/css" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  pathId = "CacheHelper";
  relpath = '';
</script>


  <script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="_index.html">Index (C)</a> &raquo;
    
    
    <span class="title">CacheHelper</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><h1>Module: CacheHelper
  
  
  
</h1>
<div class="box_info">
  

  
  
  
  
  

  

  
  <dl>
    <dt>Defined in:</dt>
    <dd>app/helpers/cache_helper.rb</dd>
  </dl>
  
</div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    
<p>This is included to ApplicationController Contains helper methods for cache handling</p>


  </div>
</div>
<div class="tags">
  

</div>
  
    <h2>
      Constant Summary
      <small><a href="#" class="constants_summary_toggle">collapse</a></small>
    </h2>

    <dl class="constants">
      
        <dt id="KASSI_DATA_CACHE_EXPIRE_TIME-constant" class="">KASSI_DATA_CACHE_EXPIRE_TIME =
          <div class="docstring">
  <div class="discussion">
    
<p>used for things that are stored completely on Sharetribe db</p>


  </div>
</div>
<div class="tags">
  

</div>
        </dt>
        <dd><pre class="code"><span class='int'>4</span><span class='period'>.</span><span class='id identifier rubyid_hours'>hours</span></pre></dd>
      
        <dt id="FRAGMENT_CACHE_EXPIRE_TIME-constant" class="">FRAGMENT_CACHE_EXPIRE_TIME =
          <div class="docstring">
  <div class="discussion">
    
<p>used to ensure “soft changes” e.g. translation updates propagate to cached fragments eventually</p>


  </div>
</div>
<div class="tags">
  

</div>
        </dt>
        <dd><pre class="code"><span class='int'>4</span><span class='period'>.</span><span class='id identifier rubyid_hours'>hours</span></pre></dd>
      
    </dl>
  







  
    <h2>
      Class Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#favors_last_changed-class_method" title="favors_last_changed (class method)">.<strong>favors_last_changed</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#frontpage_last_changed-class_method" title="frontpage_last_changed (class method)">.<strong>frontpage_last_changed</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#items_last_changed-class_method" title="items_last_changed (class method)">.<strong>items_last_changed</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#listings_last_changed-class_method" title="listings_last_changed (class method)">.<strong>listings_last_changed</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#notifications_last_changed_for-class_method" title="notifications_last_changed_for (class method)">.<strong>notifications_last_changed_for</strong>(id)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#update_favors_last_changed-class_method" title="update_favors_last_changed (class method)">.<strong>update_favors_last_changed</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#update_items_last_changed-class_method" title="update_items_last_changed (class method)">.<strong>update_items_last_changed</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#update_kassi_events_last_changed-class_method" title="update_kassi_events_last_changed (class method)">.<strong>update_kassi_events_last_changed</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#update_listings_last_changed-class_method" title="update_listings_last_changed (class method)">.<strong>update_listings_last_changed</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#update_notifications_last_changed_for-class_method" title="update_notifications_last_changed_for (class method)">.<strong>update_notifications_last_changed_for</strong>(id)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
    </ul>
  
    <h2>
      Instance Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#frontpage_fragment_cache-instance_method" title="#frontpage_fragment_cache (instance method)">#<strong>frontpage_fragment_cache</strong>(type, listing, &amp;block)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><ul><li>
<p>people_last_changed (Time.now.to_i) tästä ei voi olla varmaa tietoa, joten oltava myös expire-aika * groups_last_changed (Time.now.to_i) tästä ei voi olla varmaa tietoa, joten oltava myös expire-aika.</p>
</li></ul>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#react_component_cache-instance_method" title="#react_component_cache (instance method)">#<strong>react_component_cache</strong>(name:, props:, rails_context_keys: [], extra_keys: [], &amp;block)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Cache helper for React components.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#update_caches_dependent_on_groups-instance_method" title="#update_caches_dependent_on_groups (instance method)">#<strong>update_caches_dependent_on_groups</strong>(person)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
    </ul>
  



  <div id="class_method_details" class="method_details_list">
    <h2>Class Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="favors_last_changed-class_method">
  
    .<strong>favors_last_changed</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


13
14
15</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/helpers/cache_helper.rb', line 13</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_favors_last_changed'>favors_last_changed</span>
  <span class='const'>Rails</span><span class='period'>.</span><span class='id identifier rubyid_cache'>cache</span><span class='period'>.</span><span class='id identifier rubyid_fetch'>fetch</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>favors_last_changed</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:expires_in</span> <span class='op'>=&gt;</span> <span class='const'><span class='object_link'><a href="#KASSI_DATA_CACHE_EXPIRE_TIME-constant" title="CacheHelper::KASSI_DATA_CACHE_EXPIRE_TIME (constant)">KASSI_DATA_CACHE_EXPIRE_TIME</a></span></span><span class='rparen'>)</span> <span class='lbrace'>{</span><span class='const'>Time</span><span class='period'>.</span><span class='id identifier rubyid_now'>now</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span><span class='rbrace'>}</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="frontpage_last_changed-class_method">
  
    .<strong>frontpage_last_changed</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


37
38
39</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/helpers/cache_helper.rb', line 37</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_frontpage_last_changed'>frontpage_last_changed</span>
  <span class='const'>Rails</span><span class='period'>.</span><span class='id identifier rubyid_cache'>cache</span><span class='period'>.</span><span class='id identifier rubyid_fetch'>fetch</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>frontpage_last_changed</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:expires_in</span> <span class='op'>=&gt;</span> <span class='const'><span class='object_link'><a href="#KASSI_DATA_CACHE_EXPIRE_TIME-constant" title="CacheHelper::KASSI_DATA_CACHE_EXPIRE_TIME (constant)">KASSI_DATA_CACHE_EXPIRE_TIME</a></span></span><span class='rparen'>)</span> <span class='lbrace'>{</span><span class='const'>Time</span><span class='period'>.</span><span class='id identifier rubyid_now'>now</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span><span class='rbrace'>}</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="items_last_changed-class_method">
  
    .<strong>items_last_changed</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


21
22
23</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/helpers/cache_helper.rb', line 21</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_items_last_changed'>items_last_changed</span>
  <span class='const'>Rails</span><span class='period'>.</span><span class='id identifier rubyid_cache'>cache</span><span class='period'>.</span><span class='id identifier rubyid_fetch'>fetch</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>items_last_changed</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:expires_in</span> <span class='op'>=&gt;</span> <span class='const'><span class='object_link'><a href="#KASSI_DATA_CACHE_EXPIRE_TIME-constant" title="CacheHelper::KASSI_DATA_CACHE_EXPIRE_TIME (constant)">KASSI_DATA_CACHE_EXPIRE_TIME</a></span></span><span class='rparen'>)</span> <span class='lbrace'>{</span><span class='const'>Time</span><span class='period'>.</span><span class='id identifier rubyid_now'>now</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span><span class='rbrace'>}</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="listings_last_changed-class_method">
  
    .<strong>listings_last_changed</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


29
30
31</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/helpers/cache_helper.rb', line 29</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_listings_last_changed'>listings_last_changed</span>
  <span class='const'>Rails</span><span class='period'>.</span><span class='id identifier rubyid_cache'>cache</span><span class='period'>.</span><span class='id identifier rubyid_fetch'>fetch</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>listings_last_changed</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:expires_in</span> <span class='op'>=&gt;</span> <span class='const'><span class='object_link'><a href="#KASSI_DATA_CACHE_EXPIRE_TIME-constant" title="CacheHelper::KASSI_DATA_CACHE_EXPIRE_TIME (constant)">KASSI_DATA_CACHE_EXPIRE_TIME</a></span></span><span class='rparen'>)</span> <span class='lbrace'>{</span><span class='const'>Time</span><span class='period'>.</span><span class='id identifier rubyid_now'>now</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span><span class='rbrace'>}</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="notifications_last_changed_for-class_method">
  
    .<strong>notifications_last_changed_for</strong>(id)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


45
46
47</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/helpers/cache_helper.rb', line 45</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_notifications_last_changed_for'>notifications_last_changed_for</span><span class='lparen'>(</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span>
  <span class='const'>Rails</span><span class='period'>.</span><span class='id identifier rubyid_cache'>cache</span><span class='period'>.</span><span class='id identifier rubyid_fetch'>fetch</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>notifications_last_changed/for</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_id'>id</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:expires_in</span> <span class='op'>=&gt;</span> <span class='const'><span class='object_link'><a href="#KASSI_DATA_CACHE_EXPIRE_TIME-constant" title="CacheHelper::KASSI_DATA_CACHE_EXPIRE_TIME (constant)">KASSI_DATA_CACHE_EXPIRE_TIME</a></span></span><span class='rparen'>)</span> <span class='lbrace'>{</span><span class='const'>Time</span><span class='period'>.</span><span class='id identifier rubyid_now'>now</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span><span class='rbrace'>}</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="update_favors_last_changed-class_method">
  
    .<strong>update_favors_last_changed</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


17
18
19</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/helpers/cache_helper.rb', line 17</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_update_favors_last_changed'>update_favors_last_changed</span>
  <span class='id identifier rubyid_update_time_based_cache_key'>update_time_based_cache_key</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>favors_last_changed</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="update_items_last_changed-class_method">
  
    .<strong>update_items_last_changed</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


25
26
27</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/helpers/cache_helper.rb', line 25</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_update_items_last_changed'>update_items_last_changed</span>
  <span class='id identifier rubyid_update_time_based_cache_key'>update_time_based_cache_key</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>items_last_changed</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="update_kassi_events_last_changed-class_method">
  
    .<strong>update_kassi_events_last_changed</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


41
42
43</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/helpers/cache_helper.rb', line 41</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_update_kassi_events_last_changed'>update_kassi_events_last_changed</span>
  <span class='id identifier rubyid_update_time_based_cache_key'>update_time_based_cache_key</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>kassi_events_last_changed</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="update_listings_last_changed-class_method">
  
    .<strong>update_listings_last_changed</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


33
34
35</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/helpers/cache_helper.rb', line 33</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_update_listings_last_changed'>update_listings_last_changed</span>
  <span class='id identifier rubyid_update_time_based_cache_key'>update_time_based_cache_key</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>listings_last_changed</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="update_notifications_last_changed_for-class_method">
  
    .<strong>update_notifications_last_changed_for</strong>(id)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


49
50
51</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/helpers/cache_helper.rb', line 49</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_update_notifications_last_changed_for'>update_notifications_last_changed_for</span><span class='lparen'>(</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span>
  <span class='const'>Rails</span><span class='period'>.</span><span class='id identifier rubyid_cache'>cache</span><span class='period'>.</span><span class='id identifier rubyid_write'>write</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>notifications_last_changed/for</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_id'>id</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='const'>Time</span><span class='period'>.</span><span class='id identifier rubyid_now'>now</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span><span class='comma'>,</span> <span class='symbol'>:expires_in</span> <span class='op'>=&gt;</span> <span class='const'><span class='object_link'><a href="#KASSI_DATA_CACHE_EXPIRE_TIME-constant" title="CacheHelper::KASSI_DATA_CACHE_EXPIRE_TIME (constant)">KASSI_DATA_CACHE_EXPIRE_TIME</a></span></span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="frontpage_fragment_cache-instance_method">
  
    #<strong>frontpage_fragment_cache</strong>(type, listing, &amp;block)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <ul><li>
<p>people_last_changed (Time.now.to_i) tästä ei voi olla varmaa tietoa, joten oltava myös expire-aika</p>
</li><li>
<p>groups_last_changed (Time.now.to_i) tästä ei voi olla varmaa tietoa, joten oltava myös expire-aika</p>
</li></ul>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


69
70
71
72
73</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/helpers/cache_helper.rb', line 69</span>

<span class='kw'>def</span> <span class='id identifier rubyid_frontpage_fragment_cache'>frontpage_fragment_cache</span><span class='lparen'>(</span><span class='id identifier rubyid_type'>type</span><span class='comma'>,</span> <span class='id identifier rubyid_listing'>listing</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_listings_i18n_digest'>listings_i18n_digest</span> <span class='op'>=</span> <span class='const'>Rails</span><span class='period'>.</span><span class='id identifier rubyid_cache'>cache</span><span class='period'>.</span><span class='id identifier rubyid_fetch'>fetch</span><span class='lparen'>(</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>listings_i18n</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='ivar'>@current_community</span><span class='comma'>,</span> <span class='const'>I18n</span><span class='period'>.</span><span class='id identifier rubyid_locale'>locale</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='symbol'>:expires_in</span> <span class='op'>=&gt;</span> <span class='int'>5</span><span class='period'>.</span><span class='id identifier rubyid_minutes'>minutes</span><span class='rparen'>)</span> <span class='lbrace'>{</span> <span class='const'>Digest</span><span class='op'>::</span><span class='const'>MD5</span><span class='period'>.</span><span class='id identifier rubyid_hexdigest'>hexdigest</span> <span class='const'>I18n</span><span class='period'>.</span><span class='id identifier rubyid_t'>t</span><span class='lparen'>(</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>listings</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span> <span class='rbrace'>}</span>
  <span class='id identifier rubyid_shape_name'><span class='object_link'><a href="ListingsHelper.html#shape_name-instance_method" title="ListingsHelper#shape_name (method)">shape_name</a></span></span> <span class='op'>=</span> <span class='const'>I18n</span><span class='period'>.</span><span class='id identifier rubyid_t'>t</span><span class='lparen'>(</span><span class='id identifier rubyid_listing'>listing</span><span class='period'>.</span><span class='id identifier rubyid_shape_name_tr_key'>shape_name_tr_key</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_cache'>cache</span><span class='lparen'>(</span><span class='lbracket'>[</span><span class='id identifier rubyid_type'>type</span><span class='comma'>,</span> <span class='id identifier rubyid_shape_name'><span class='object_link'><a href="ListingsHelper.html#shape_name-instance_method" title="ListingsHelper#shape_name (method)">shape_name</a></span></span><span class='comma'>,</span> <span class='id identifier rubyid_listings_i18n_digest'>listings_i18n_digest</span><span class='comma'>,</span> <span class='ivar'>@current_community</span><span class='comma'>,</span> <span class='const'>Digest</span><span class='op'>::</span><span class='const'>SHA1</span><span class='period'>.</span><span class='id identifier rubyid_hexdigest'>hexdigest</span><span class='lparen'>(</span><span class='id identifier rubyid_listing'>listing</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='const'>MoneyRails</span><span class='op'>::</span><span class='const'>Configuration</span><span class='period'>.</span><span class='id identifier rubyid_no_cents_if_whole'>no_cents_if_whole</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='symbol'>:expires_in</span> <span class='op'>=&gt;</span> <span class='const'><span class='object_link'><a href="#FRAGMENT_CACHE_EXPIRE_TIME-constant" title="CacheHelper::FRAGMENT_CACHE_EXPIRE_TIME (constant)">FRAGMENT_CACHE_EXPIRE_TIME</a></span></span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="react_component_cache-instance_method">
  
    #<strong>react_component_cache</strong>(name:, props:, rails_context_keys: [], extra_keys: [], &amp;block)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Cache helper for React components</p>

<p>Params:</p>
<ul><li>
<p>`name`: the name of the component (string)</p>
</li><li>
<p>`props`: props (hash)</p>
</li><li>
<p>`rails_context_keys`: list of values in railsContext that should</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_invalidate'>invalidate</span> <span class='id identifier rubyid_the'>the</span> <span class='id identifier rubyid_cache'>cache</span>
</code></pre>
</li><li>
<p>`extra_keys`: anything extra that should invalidate the cache</p>
</li></ul>

<p>Note about `rails_context_keys`: In order to properly invalidate the cache, you need to list here all keys in the railsContext hash that should invalidate the cache. You don&#39;t need to include keys if they don&#39;t affect to the server rendered output of the component.</p>

<p>Please note that if you turn on caching in development but do not run assets:precompile, the cache will not be invalidated because the server bundle filename doesn&#39;t change.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/helpers/cache_helper.rb', line 95</span>

<span class='kw'>def</span> <span class='id identifier rubyid_react_component_cache'>react_component_cache</span><span class='lparen'>(</span><span class='label'>name:</span><span class='comma'>,</span> <span class='label'>props:</span><span class='comma'>,</span> <span class='label'>rails_context_keys:</span> <span class='lbracket'>[</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='label'>extra_keys:</span> <span class='lbracket'>[</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_controller'>controller</span><span class='period'>.</span><span class='id identifier rubyid_perform_caching'>perform_caching</span> <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='id identifier rubyid_digest_assets'>digest_assets</span>
    <span class='const'>Rails</span><span class='period'>.</span><span class='id identifier rubyid_logger'>logger</span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span><span class='lparen'>(</span>
      <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>&#39;perform_caching&#39; is turned on but the assets do not have digest. </span><span class='tstring_end'>&quot;</span></span> \
      <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>react_component_cache will not be invalidated correctly</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_bundle_file'>bundle_file</span> <span class='op'>=</span> <span class='id identifier rubyid_asset_path'>asset_path</span><span class='lparen'>(</span><span class='const'>ReactOnRails</span><span class='period'>.</span><span class='id identifier rubyid_configuration'>configuration</span><span class='period'>.</span><span class='id identifier rubyid_server_bundle_js_file'>server_bundle_js_file</span><span class='rparen'>)</span>

  <span class='id identifier rubyid_default_rails_context_keys'>default_rails_context_keys</span> <span class='op'>=</span> <span class='lbracket'>[</span>
    <span class='symbol'>:i18nLocale</span><span class='comma'>,</span>
    <span class='symbol'>:i18nDefaultLocale</span>
  <span class='rbracket'>]</span>

  <span class='comment'># Pick the rails context values that will affect to the rendering of
</span>  <span class='comment'># this particular component
</span>  <span class='id identifier rubyid_rails_context_subset'>rails_context_subset</span> <span class='op'>=</span> <span class='id identifier rubyid_rails_context'>rails_context</span><span class='lparen'>(</span><span class='label'>server_side:</span> <span class='kw'>false</span><span class='rparen'>)</span>
                         <span class='period'>.</span><span class='id identifier rubyid_slice'>slice</span><span class='lparen'>(</span><span class='op'>*</span><span class='lparen'>(</span><span class='id identifier rubyid_rails_context_keys'>rails_context_keys</span> <span class='op'>+</span> <span class='id identifier rubyid_default_rails_context_keys'>default_rails_context_keys</span><span class='rparen'>)</span><span class='rparen'>)</span>

  <span class='comment'># All values in rails context extension will invalidate the
</span>  <span class='comment'># cache, if the values change
</span>  <span class='id identifier rubyid_rails_context_extension'>rails_context_extension</span> <span class='op'>=</span> <span class='const'>RailsContextExtension</span><span class='period'>.</span><span class='id identifier rubyid_custom_context'>custom_context</span><span class='lparen'>(</span><span class='kw'>self</span><span class='rparen'>)</span>

  <span class='id identifier rubyid_keys'>keys</span> <span class='op'>=</span> <span class='lbracket'>[</span>
    <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>react_component_cache_v2</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span>
    <span class='id identifier rubyid_name'>name</span><span class='comma'>,</span>
    <span class='id identifier rubyid_props'>props</span><span class='comma'>,</span>
    <span class='id identifier rubyid_locale'>locale</span><span class='comma'>,</span>
    <span class='id identifier rubyid_bundle_file'>bundle_file</span><span class='comma'>,</span>
    <span class='id identifier rubyid_rails_context_extension'>rails_context_extension</span><span class='comma'>,</span>
    <span class='id identifier rubyid_rails_context_subset'>rails_context_subset</span>
  <span class='rbracket'>]</span>

  <span class='comment'># We can skip the digest because we don&#39;t care if the .haml template changes.
</span>  <span class='id identifier rubyid_cache'>cache</span><span class='lparen'>(</span><span class='id identifier rubyid_keys'>keys</span> <span class='op'>+</span> <span class='id identifier rubyid_extra_keys'>extra_keys</span><span class='comma'>,</span> <span class='lbrace'>{</span><span class='label'>skip_digest:</span> <span class='kw'>true</span><span class='rbrace'>}</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="update_caches_dependent_on_groups-instance_method">
  
    #<strong>update_caches_dependent_on_groups</strong>(person)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


53
54
55
56
57
58
59
60
61
62
63
64</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/helpers/cache_helper.rb', line 53</span>

<span class='kw'>def</span> <span class='id identifier rubyid_update_caches_dependent_on_groups'>update_caches_dependent_on_groups</span><span class='lparen'>(</span><span class='id identifier rubyid_person'>person</span><span class='rparen'>)</span>
  <span class='comment'># I18n.available_locales.each do |locale|
</span>  <span class='comment'>#   Rails.cache.delete(&quot;items_list/#{locale.to_s}/#{items_last_changed}/#{person.id}&quot;)
</span>  <span class='comment'>#  end
</span>
  <span class='comment'># SHOULD USE SOMETHING LIKE ABOVE
</span>  <span class='comment'># this one below clears all the caches, so it slows the system down unnecessarily.
</span>
   <span class='const'><span class='object_link'><a href="" title="CacheHelper (module)">CacheHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_update_favors_last_changed'><span class='object_link'><a href="#update_favors_last_changed-class_method" title="CacheHelper.update_favors_last_changed (method)">update_favors_last_changed</a></span></span>
   <span class='const'><span class='object_link'><a href="" title="CacheHelper (module)">CacheHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_update_items_last_changed'><span class='object_link'><a href="#update_items_last_changed-class_method" title="CacheHelper.update_items_last_changed (method)">update_items_last_changed</a></span></span>
   <span class='const'><span class='object_link'><a href="" title="CacheHelper (module)">CacheHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_update_listings_last_changed'><span class='object_link'><a href="#update_listings_last_changed-class_method" title="CacheHelper.update_listings_last_changed (method)">update_listings_last_changed</a></span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

      <div id="footer">
  Generated on Tue Feb 11 14:01:34 2020 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.19 (ruby-2.6.2).
</div>

    </div>
  </body>
</html>