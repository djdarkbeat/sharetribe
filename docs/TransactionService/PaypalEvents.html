<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Module: TransactionService::PaypalEvents
  
    &mdash; Documentation by YARD 0.9.19
  
</title>

  <link rel="stylesheet" href="../css/style.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="../css/common.css" type="text/css" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  pathId = "TransactionService::PaypalEvents";
  relpath = '../';
</script>


  <script type="text/javascript" charset="utf-8" src="../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="../class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="../_index.html">Index (P)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../TransactionService.html" title="TransactionService (module)">TransactionService</a></span></span>
     &raquo; 
    <span class="title">PaypalEvents</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><h1>Module: TransactionService::PaypalEvents
  
  
  
</h1>
<div class="box_info">
  

  
  
  
  
  

  

  
  <dl>
    <dt>Defined in:</dt>
    <dd>app/services/transaction_service/paypal_events.rb</dd>
  </dl>
  
</div>


  
    <h2>
      Constant Summary
      <small><a href="#" class="constants_summary_toggle">collapse</a></small>
    </h2>

    <dl class="constants">
      
        <dt id="TransactionStore-constant" class="">TransactionStore =
          
        </dt>
        <dd><pre class="code"><span class='const'><span class='object_link'><a href="../TransactionService.html" title="TransactionService (module)">TransactionService</a></span></span><span class='op'>::</span><span class='const'>Store</span><span class='op'>::</span><span class='const'>Transaction</span></pre></dd>
      
        <dt id="TxModel-constant" class="">TxModel =
          
        </dt>
        <dd><pre class="code"><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Transaction.html" title="Transaction (class)">Transaction</a></span></span></pre></dd>
      
        <dt id="TRANSITIONS-constant" class="">TRANSITIONS =
          <div class="docstring">
  <div class="discussion">
    
<p>Mapping from payment transition to transaction transition</p>


  </div>
</div>
<div class="tags">
  

</div>
        </dt>
        <dd><pre class="code"><span class='lbracket'>[</span>
  <span class='lbrace'>{</span><span class='label'>name:</span> <span class='symbol'>:initiated_to_preauthorized</span><span class='comma'>,</span>   <span class='label'>actor:</span> <span class='symbol'>:starter</span><span class='comma'>,</span> <span class='label'>state:</span> <span class='lbracket'>[</span><span class='symbol'>:initiated</span><span class='comma'>,</span> <span class='symbol'>:pending</span><span class='comma'>,</span> <span class='symbol'>:authorization</span><span class='rbracket'>]</span><span class='rbrace'>}</span><span class='comma'>,</span>
  <span class='lbrace'>{</span><span class='label'>name:</span> <span class='symbol'>:initiated_to_voided</span><span class='comma'>,</span>          <span class='label'>actor:</span> <span class='symbol'>:starter</span><span class='comma'>,</span> <span class='label'>state:</span> <span class='lbracket'>[</span><span class='symbol'>:initiated</span><span class='comma'>,</span> <span class='symbol'>:voided</span><span class='rbracket'>]</span><span class='rbrace'>}</span><span class='comma'>,</span>
  <span class='lbrace'>{</span><span class='label'>name:</span> <span class='symbol'>:preauthorized_to_paid</span><span class='comma'>,</span>        <span class='label'>actor:</span> <span class='symbol'>:author</span><span class='comma'>,</span>  <span class='label'>state:</span> <span class='lbracket'>[</span><span class='symbol'>:preauthorized</span><span class='comma'>,</span> <span class='symbol'>:completed</span><span class='rbracket'>]</span><span class='rbrace'>}</span><span class='comma'>,</span>
  <span class='lbrace'>{</span><span class='label'>name:</span> <span class='symbol'>:preauthorized_to_pending_ext</span><span class='comma'>,</span> <span class='label'>actor:</span> <span class='symbol'>:author</span><span class='comma'>,</span>  <span class='label'>state:</span> <span class='lbracket'>[</span><span class='symbol'>:preauthorized</span><span class='comma'>,</span> <span class='symbol'>:pending</span><span class='rbracket'>]</span><span class='rbrace'>}</span><span class='comma'>,</span>
  <span class='lbrace'>{</span><span class='label'>name:</span> <span class='symbol'>:pending_ext_to_paid</span><span class='comma'>,</span>          <span class='label'>actor:</span> <span class='symbol'>:author</span><span class='comma'>,</span>  <span class='label'>state:</span> <span class='lbracket'>[</span><span class='symbol'>:pending_ext</span><span class='comma'>,</span> <span class='symbol'>:completed</span><span class='rbracket'>]</span><span class='rbrace'>}</span><span class='comma'>,</span>
  <span class='lbrace'>{</span><span class='label'>name:</span> <span class='symbol'>:preauthorized_to_voided</span><span class='comma'>,</span>      <span class='label'>actor:</span> <span class='symbol'>:author</span><span class='comma'>,</span>  <span class='label'>state:</span> <span class='lbracket'>[</span><span class='symbol'>:preauthorized</span><span class='comma'>,</span> <span class='symbol'>:voided</span><span class='rbracket'>]</span><span class='rbrace'>}</span><span class='comma'>,</span>
  <span class='lbrace'>{</span><span class='label'>name:</span> <span class='symbol'>:preauthorized_to_expired</span><span class='comma'>,</span>     <span class='label'>actor:</span> <span class='symbol'>:author</span><span class='comma'>,</span>  <span class='label'>state:</span> <span class='lbracket'>[</span><span class='symbol'>:preauthorized</span><span class='comma'>,</span> <span class='symbol'>:expired</span><span class='rbracket'>]</span><span class='rbrace'>}</span><span class='comma'>,</span>
  <span class='lbrace'>{</span><span class='label'>name:</span> <span class='symbol'>:pending_ext_to_denied</span><span class='comma'>,</span>        <span class='label'>actor:</span> <span class='symbol'>:author</span><span class='comma'>,</span>  <span class='label'>state:</span> <span class='lbracket'>[</span><span class='symbol'>:pending_ext</span><span class='comma'>,</span> <span class='symbol'>:denied</span><span class='rbracket'>]</span><span class='rbrace'>}</span>
<span class='rbracket'>]</span></pre></dd>
      
    </dl>
  







  
    <h2>
      Class Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#delete_transaction-class_method" title="delete_transaction (class method)">.<strong>delete_transaction</strong>(cid:, tx_id:)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#first_matching_transition-class_method" title="first_matching_transition (class method)">.<strong>first_matching_transition</strong>(transitions, val)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#initiated_to_preauthorized-class_method" title="initiated_to_preauthorized (class method)">.<strong>initiated_to_preauthorized</strong>(tx)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#payment_updated-class_method" title="payment_updated (class method)">.<strong>payment_updated</strong>(flow, payment)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#pending_ext%3F-class_method" title="pending_ext? (class method)">.<strong>pending_ext?</strong>(pending_reason)  &#x21d2; Boolean </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#pending_ext_to_denied-class_method" title="pending_ext_to_denied (class method)">.<strong>pending_ext_to_denied</strong>(tx, payment_status)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#pending_ext_to_paid-class_method" title="pending_ext_to_paid (class method)">.<strong>pending_ext_to_paid</strong>(tx)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#preauthorized_to_errored-class_method" title="preauthorized_to_errored (class method)">.<strong>preauthorized_to_errored</strong>(tx)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Transaction transition handlers.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#preauthorized_to_paid-class_method" title="preauthorized_to_paid (class method)">.<strong>preauthorized_to_paid</strong>(tx)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#preauthorized_to_pending_ext-class_method" title="preauthorized_to_pending_ext (class method)">.<strong>preauthorized_to_pending_ext</strong>(tx, pending_reason)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#preauthorized_to_rejected-class_method" title="preauthorized_to_rejected (class method)">.<strong>preauthorized_to_rejected</strong>(tx, payment_status = nil)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#request_cancelled-class_method" title="request_cancelled (class method)">.<strong>request_cancelled</strong>(flow, token)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Paypal payment request was cancelled, remove the associated transaction.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#shipping_fields_present%3F-class_method" title="shipping_fields_present? (class method)">.<strong>shipping_fields_present?</strong>(details)  &#x21d2; Boolean </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Privates.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#transition_type-class_method" title="transition_type (class method)">.<strong>transition_type</strong>(tx, payment)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#update_transaction_details-class_method" title="update_transaction_details (class method)">.<strong>update_transaction_details</strong>(flow, details)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
    </ul>
  



  <div id="class_method_details" class="method_details_list">
    <h2>Class Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="delete_transaction-class_method">
  
    .<strong>delete_transaction</strong>(cid:, tx_id:)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


142
143
144
145
146</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/services/transaction_service/paypal_events.rb', line 142</span>

<span class='kw'>def</span> <span class='id identifier rubyid_delete_transaction'>delete_transaction</span><span class='lparen'>(</span><span class='label'>cid:</span><span class='comma'>,</span> <span class='label'>tx_id:</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='const'><span class='object_link'><a href="#TransactionStore-constant" title="TransactionService::PaypalEvents::TransactionStore (constant)">TransactionStore</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_in_community'>get_in_community</span><span class='lparen'>(</span><span class='label'>community_id:</span> <span class='id identifier rubyid_cid'>cid</span><span class='comma'>,</span> <span class='label'>transaction_id:</span> <span class='id identifier rubyid_tx_id'>tx_id</span><span class='rparen'>)</span>
    <span class='const'><span class='object_link'><a href="#TransactionStore-constant" title="TransactionService::PaypalEvents::TransactionStore (constant)">TransactionStore</a></span></span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span><span class='lparen'>(</span><span class='label'>community_id:</span> <span class='id identifier rubyid_cid'>cid</span><span class='comma'>,</span> <span class='label'>transaction_id:</span> <span class='id identifier rubyid_tx_id'>tx_id</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="first_matching_transition-class_method">
  
    .<strong>first_matching_transition</strong>(transitions, val)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


93
94
95</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/services/transaction_service/paypal_events.rb', line 93</span>

<span class='kw'>def</span> <span class='id identifier rubyid_first_matching_transition'>first_matching_transition</span><span class='lparen'>(</span><span class='id identifier rubyid_transitions'>transitions</span><span class='comma'>,</span> <span class='id identifier rubyid_val'>val</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_transitions'>transitions</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_transition'>transition</span><span class='op'>|</span> <span class='id identifier rubyid_transition'>transition</span><span class='lbracket'>[</span><span class='symbol'>:state</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_zip'>zip</span><span class='lparen'>(</span><span class='id identifier rubyid_val'>val</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_all?'>all?</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='lparen'>(</span><span class='id identifier rubyid_p1'>p1</span><span class='comma'>,</span> <span class='id identifier rubyid_p2'>p2</span><span class='rparen'>)</span><span class='op'>|</span> <span class='id identifier rubyid_p1'>p1</span> <span class='op'>==</span> <span class='id identifier rubyid_p2'>p2</span> <span class='rbrace'>}</span> <span class='rbrace'>}</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="initiated_to_preauthorized-class_method">
  
    .<strong>initiated_to_preauthorized</strong>(tx)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


111
112
113
114
115
116</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/services/transaction_service/paypal_events.rb', line 111</span>

<span class='kw'>def</span> <span class='id identifier rubyid_initiated_to_preauthorized'>initiated_to_preauthorized</span><span class='lparen'>(</span><span class='id identifier rubyid_tx'>tx</span><span class='rparen'>)</span>
  <span class='const'><span class='object_link'><a href="../TransactionService.html" title="TransactionService (module)">TransactionService</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Transaction.html" title="TransactionService::Transaction (module)">Transaction</a></span></span><span class='period'>.</span><span class='id identifier rubyid_finalize_create'><span class='object_link'><a href="Transaction.html#finalize_create-class_method" title="TransactionService::Transaction.finalize_create (method)">finalize_create</a></span></span><span class='lparen'>(</span>
    <span class='label'>community_id:</span> <span class='id identifier rubyid_tx'>tx</span><span class='period'>.</span><span class='id identifier rubyid_community_id'>community_id</span><span class='comma'>,</span>
    <span class='label'>transaction_id:</span> <span class='id identifier rubyid_tx'>tx</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span>
    <span class='label'>force_sync:</span> <span class='kw'>false</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="payment_updated-class_method">
  
    .<strong>payment_updated</strong>(flow, payment)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/services/transaction_service/paypal_events.rb', line 15</span>

<span class='kw'>def</span> <span class='id identifier rubyid_payment_updated'>payment_updated</span><span class='lparen'>(</span><span class='id identifier rubyid_flow'>flow</span><span class='comma'>,</span> <span class='id identifier rubyid_payment'>payment</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_tx'>tx</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="#TxModel-constant" title="TransactionService::PaypalEvents::TxModel (constant)">TxModel</a></span></span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='label'>id:</span> <span class='id identifier rubyid_payment'>payment</span><span class='lbracket'>[</span><span class='symbol'>:transaction_id</span><span class='rbracket'>]</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_tx'>tx</span>
    <span class='id identifier rubyid_transition'>transition</span> <span class='op'>=</span> <span class='id identifier rubyid_transition_type'>transition_type</span><span class='lparen'>(</span><span class='id identifier rubyid_tx'>tx</span><span class='comma'>,</span> <span class='id identifier rubyid_payment'>payment</span><span class='rparen'>)</span>

    <span class='comment'># Event can be triggered due to a
</span>    <span class='comment'>#
</span>    <span class='comment'># a) user action
</span>    <span class='comment'># b) IPN message
</span>    <span class='comment'># c) scheduled retry job
</span>    <span class='comment'>#
</span>    <span class='comment'># In case of b) and c), we need to initialize the SessionContext here
</span>    <span class='comment'>#
</span>    <span class='const'><span class='object_link'><a href="../SessionContextStore.html" title="SessionContextStore (module)">SessionContextStore</a></span></span><span class='period'>.</span><span class='id identifier rubyid_set_from_transaction'><span class='object_link'><a href="../SessionContextStore.html#set_from_transaction-class_method" title="SessionContextStore.set_from_transaction (method)">set_from_transaction</a></span></span><span class='lparen'>(</span><span class='label'>actor:</span> <span class='id identifier rubyid_transition'>transition</span><span class='lbracket'>[</span><span class='symbol'>:actor</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='label'>tx:</span> <span class='id identifier rubyid_tx'>tx</span><span class='rparen'>)</span>
    <span class='const'><span class='object_link'><a href="../ApplicationHelper.html" title="ApplicationHelper (module)">ApplicationHelper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_store_community_service_name_to_thread_from_community_id'><span class='object_link'><a href="../ApplicationHelper.html#store_community_service_name_to_thread_from_community_id-class_method" title="ApplicationHelper.store_community_service_name_to_thread_from_community_id (method)">store_community_service_name_to_thread_from_community_id</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_tx'>tx</span><span class='period'>.</span><span class='id identifier rubyid_community_id'>community_id</span><span class='rparen'>)</span>

    <span class='kw'>case</span> <span class='id identifier rubyid_transition'>transition</span><span class='lbracket'>[</span><span class='symbol'>:name</span><span class='rbracket'>]</span>
    <span class='kw'>when</span> <span class='symbol'>:initiated_to_preauthorized</span>
      <span class='id identifier rubyid_initiated_to_preauthorized'>initiated_to_preauthorized</span><span class='lparen'>(</span><span class='id identifier rubyid_tx'>tx</span><span class='rparen'>)</span>
    <span class='kw'>when</span> <span class='symbol'>:initiated_to_voided</span>
      <span class='id identifier rubyid_delete_transaction'>delete_transaction</span><span class='lparen'>(</span><span class='label'>cid:</span> <span class='id identifier rubyid_tx'>tx</span><span class='period'>.</span><span class='id identifier rubyid_community_id'>community_id</span><span class='comma'>,</span> <span class='label'>tx_id:</span> <span class='id identifier rubyid_tx'>tx</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span>
    <span class='kw'>when</span> <span class='symbol'>:preauthorized_to_paid</span>
      <span class='id identifier rubyid_preauthorized_to_paid'>preauthorized_to_paid</span><span class='lparen'>(</span><span class='id identifier rubyid_tx'>tx</span><span class='rparen'>)</span>
    <span class='kw'>when</span> <span class='symbol'>:preauthorized_to_pending_ext</span>
      <span class='id identifier rubyid_preauthorized_to_pending_ext'>preauthorized_to_pending_ext</span><span class='lparen'>(</span><span class='id identifier rubyid_tx'>tx</span><span class='comma'>,</span> <span class='id identifier rubyid_payment'>payment</span><span class='lbracket'>[</span><span class='symbol'>:pending_reason</span><span class='rbracket'>]</span><span class='rparen'>)</span>
    <span class='kw'>when</span> <span class='symbol'>:pending_ext_to_paid</span>
      <span class='id identifier rubyid_pending_ext_to_paid'>pending_ext_to_paid</span><span class='lparen'>(</span><span class='id identifier rubyid_tx'>tx</span><span class='rparen'>)</span>
    <span class='kw'>when</span> <span class='symbol'>:preauthorized_to_voided</span>
      <span class='id identifier rubyid_preauthorized_to_rejected'>preauthorized_to_rejected</span><span class='lparen'>(</span><span class='id identifier rubyid_tx'>tx</span><span class='rparen'>)</span> <span class='kw'>if</span><span class='lparen'>(</span><span class='id identifier rubyid_flow'>flow</span> <span class='op'>==</span> <span class='symbol'>:success</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_preauthorized_to_errored'>preauthorized_to_errored</span><span class='lparen'>(</span><span class='id identifier rubyid_tx'>tx</span><span class='rparen'>)</span> <span class='kw'>if</span><span class='lparen'>(</span><span class='id identifier rubyid_flow'>flow</span> <span class='op'>==</span> <span class='symbol'>:error</span><span class='rparen'>)</span>
    <span class='kw'>when</span> <span class='symbol'>:preauthorized_to_expired</span>
      <span class='id identifier rubyid_preauthorized_to_rejected'>preauthorized_to_rejected</span><span class='lparen'>(</span><span class='id identifier rubyid_tx'>tx</span><span class='comma'>,</span> <span class='id identifier rubyid_payment'>payment</span><span class='lbracket'>[</span><span class='symbol'>:payment_status</span><span class='rbracket'>]</span><span class='rparen'>)</span>
    <span class='kw'>when</span> <span class='symbol'>:pending_ext_to_denied</span>
      <span class='id identifier rubyid_pending_ext_to_denied'>pending_ext_to_denied</span><span class='lparen'>(</span><span class='id identifier rubyid_tx'>tx</span><span class='comma'>,</span> <span class='id identifier rubyid_payment'>payment</span><span class='lbracket'>[</span><span class='symbol'>:payment_status</span><span class='rbracket'>]</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="pending_ext?-class_method">
  
    .<strong>pending_ext?</strong>(pending_reason)  &#x21d2; <tt>Boolean</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


130
131
132</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/services/transaction_service/paypal_events.rb', line 130</span>

<span class='kw'>def</span> <span class='id identifier rubyid_pending_ext?'>pending_ext?</span><span class='lparen'>(</span><span class='id identifier rubyid_pending_reason'>pending_reason</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_pending_reason'>pending_reason</span> <span class='op'>!=</span> <span class='symbol'>:order</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_pending_reason'>pending_reason</span> <span class='op'>!=</span> <span class='symbol'>:authorization</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="pending_ext_to_denied-class_method">
  
    .<strong>pending_ext_to_denied</strong>(tx, payment_status)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


107
108
109</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/services/transaction_service/paypal_events.rb', line 107</span>

<span class='kw'>def</span> <span class='id identifier rubyid_pending_ext_to_denied'>pending_ext_to_denied</span><span class='lparen'>(</span><span class='id identifier rubyid_tx'>tx</span><span class='comma'>,</span> <span class='id identifier rubyid_payment_status'>payment_status</span><span class='rparen'>)</span>
  <span class='const'><span class='object_link'><a href="../TransactionService.html" title="TransactionService (module)">TransactionService</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="StateMachine.html" title="TransactionService::StateMachine (module)">StateMachine</a></span></span><span class='period'>.</span><span class='id identifier rubyid_transition_to'><span class='object_link'><a href="StateMachine.html#transition_to-class_method" title="TransactionService::StateMachine.transition_to (method)">transition_to</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_tx'>tx</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>rejected</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>paypal_payment_status:</span> <span class='id identifier rubyid_payment_status'>payment_status</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="pending_ext_to_paid-class_method">
  
    .<strong>pending_ext_to_paid</strong>(tx)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


134
135
136
137
138
139
140</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/services/transaction_service/paypal_events.rb', line 134</span>

<span class='kw'>def</span> <span class='id identifier rubyid_pending_ext_to_paid'>pending_ext_to_paid</span><span class='lparen'>(</span><span class='id identifier rubyid_tx'>tx</span><span class='rparen'>)</span>
  <span class='comment'># Commission charge is synchronous and must complete before we
</span>  <span class='comment'># transition to paid so that we have the full payment info
</span>  <span class='comment'># available at the time we send payment receipts.
</span>  <span class='const'><span class='object_link'><a href="../TransactionService.html" title="TransactionService (module)">TransactionService</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Transaction.html" title="TransactionService::Transaction (module)">Transaction</a></span></span><span class='period'>.</span><span class='id identifier rubyid_charge_commission'><span class='object_link'><a href="Transaction.html#charge_commission-class_method" title="TransactionService::Transaction.charge_commission (method)">charge_commission</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_tx'>tx</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span>
  <span class='const'><span class='object_link'><a href="../TransactionService.html" title="TransactionService (module)">TransactionService</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="StateMachine.html" title="TransactionService::StateMachine (module)">StateMachine</a></span></span><span class='period'>.</span><span class='id identifier rubyid_transition_to'><span class='object_link'><a href="StateMachine.html#transition_to-class_method" title="TransactionService::StateMachine.transition_to (method)">transition_to</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_tx'>tx</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='symbol'>:paid</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="preauthorized_to_errored-class_method">
  
    .<strong>preauthorized_to_errored</strong>(tx)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Transaction transition handlers</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


98
99
100</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/services/transaction_service/paypal_events.rb', line 98</span>

<span class='kw'>def</span> <span class='id identifier rubyid_preauthorized_to_errored'>preauthorized_to_errored</span><span class='lparen'>(</span><span class='id identifier rubyid_tx'>tx</span><span class='rparen'>)</span>
  <span class='const'><span class='object_link'><a href="../TransactionService.html" title="TransactionService (module)">TransactionService</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="StateMachine.html" title="TransactionService::StateMachine (module)">StateMachine</a></span></span><span class='period'>.</span><span class='id identifier rubyid_transition_to'><span class='object_link'><a href="StateMachine.html#transition_to-class_method" title="TransactionService::StateMachine.transition_to (method)">transition_to</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_tx'>tx</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>errored</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="preauthorized_to_paid-class_method">
  
    .<strong>preauthorized_to_paid</strong>(tx)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


118
119
120
121
122
123
124</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/services/transaction_service/paypal_events.rb', line 118</span>

<span class='kw'>def</span> <span class='id identifier rubyid_preauthorized_to_paid'>preauthorized_to_paid</span><span class='lparen'>(</span><span class='id identifier rubyid_tx'>tx</span><span class='rparen'>)</span>
  <span class='comment'># Commission charge is synchronous and must complete before we
</span>  <span class='comment'># transition to paid so that we have the full payment info
</span>  <span class='comment'># available at the time we send payment receipts.
</span>  <span class='const'><span class='object_link'><a href="../TransactionService.html" title="TransactionService (module)">TransactionService</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Transaction.html" title="TransactionService::Transaction (module)">Transaction</a></span></span><span class='period'>.</span><span class='id identifier rubyid_charge_commission'><span class='object_link'><a href="Transaction.html#charge_commission-class_method" title="TransactionService::Transaction.charge_commission (method)">charge_commission</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_tx'>tx</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span>
  <span class='const'><span class='object_link'><a href="../TransactionService.html" title="TransactionService (module)">TransactionService</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="StateMachine.html" title="TransactionService::StateMachine (module)">StateMachine</a></span></span><span class='period'>.</span><span class='id identifier rubyid_transition_to'><span class='object_link'><a href="StateMachine.html#transition_to-class_method" title="TransactionService::StateMachine.transition_to (method)">transition_to</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_tx'>tx</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='symbol'>:paid</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="preauthorized_to_pending_ext-class_method">
  
    .<strong>preauthorized_to_pending_ext</strong>(tx, pending_reason)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


126
127
128</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/services/transaction_service/paypal_events.rb', line 126</span>

<span class='kw'>def</span> <span class='id identifier rubyid_preauthorized_to_pending_ext'>preauthorized_to_pending_ext</span><span class='lparen'>(</span><span class='id identifier rubyid_tx'>tx</span><span class='comma'>,</span> <span class='id identifier rubyid_pending_reason'>pending_reason</span><span class='rparen'>)</span>
  <span class='const'><span class='object_link'><a href="../TransactionService.html" title="TransactionService (module)">TransactionService</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="StateMachine.html" title="TransactionService::StateMachine (module)">StateMachine</a></span></span><span class='period'>.</span><span class='id identifier rubyid_transition_to'><span class='object_link'><a href="StateMachine.html#transition_to-class_method" title="TransactionService::StateMachine.transition_to (method)">transition_to</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_tx'>tx</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='symbol'>:pending_ext</span><span class='comma'>,</span> <span class='label'>paypal_pending_reason:</span> <span class='id identifier rubyid_pending_reason'>pending_reason</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_pending_ext?'>pending_ext?</span><span class='lparen'>(</span><span class='id identifier rubyid_pending_reason'>pending_reason</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="preauthorized_to_rejected-class_method">
  
    .<strong>preauthorized_to_rejected</strong>(tx, payment_status = nil)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


102
103
104
105</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/services/transaction_service/paypal_events.rb', line 102</span>

<span class='kw'>def</span> <span class='id identifier rubyid_preauthorized_to_rejected'>preauthorized_to_rejected</span><span class='lparen'>(</span><span class='id identifier rubyid_tx'>tx</span><span class='comma'>,</span> <span class='id identifier rubyid_payment_status'>payment_status</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_metadata'>metadata</span> <span class='op'>=</span> <span class='id identifier rubyid_payment_status'>payment_status</span> <span class='op'>?</span> <span class='lbrace'>{</span> <span class='label'>paypal_payment_status:</span> <span class='id identifier rubyid_payment_status'>payment_status</span> <span class='rbrace'>}</span> <span class='op'>:</span> <span class='kw'>nil</span>
  <span class='const'><span class='object_link'><a href="../TransactionService.html" title="TransactionService (module)">TransactionService</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="StateMachine.html" title="TransactionService::StateMachine (module)">StateMachine</a></span></span><span class='period'>.</span><span class='id identifier rubyid_transition_to'><span class='object_link'><a href="StateMachine.html#transition_to-class_method" title="TransactionService::StateMachine.transition_to (method)">transition_to</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_tx'>tx</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>rejected</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_metadata'>metadata</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="request_cancelled-class_method">
  
    .<strong>request_cancelled</strong>(flow, token)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Paypal payment request was cancelled, remove the associated transaction</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


11
12
13</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/services/transaction_service/paypal_events.rb', line 11</span>

<span class='kw'>def</span> <span class='id identifier rubyid_request_cancelled'>request_cancelled</span><span class='lparen'>(</span><span class='id identifier rubyid_flow'>flow</span><span class='comma'>,</span> <span class='id identifier rubyid_token'>token</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_delete_transaction'>delete_transaction</span><span class='lparen'>(</span><span class='label'>cid:</span> <span class='id identifier rubyid_token'>token</span><span class='lbracket'>[</span><span class='symbol'>:community_id</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='label'>tx_id:</span> <span class='id identifier rubyid_token'>token</span><span class='lbracket'>[</span><span class='symbol'>:transaction_id</span><span class='rbracket'>]</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="shipping_fields_present?-class_method">
  
    .<strong>shipping_fields_present?</strong>(details)  &#x21d2; <tt>Boolean</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Privates</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


67
68
69</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/services/transaction_service/paypal_events.rb', line 67</span>

<span class='kw'>def</span> <span class='id identifier rubyid_shipping_fields_present?'>shipping_fields_present?</span><span class='lparen'>(</span><span class='id identifier rubyid_details'>details</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_details'>details</span><span class='period'>.</span><span class='id identifier rubyid_except'>except</span><span class='lparen'>(</span><span class='symbol'>:status</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_values'>values</span><span class='period'>.</span><span class='id identifier rubyid_any?'>any?</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="transition_type-class_method">
  
    .<strong>transition_type</strong>(tx, payment)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


84
85
86
87
88
89
90
91</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/services/transaction_service/paypal_events.rb', line 84</span>

<span class='kw'>def</span> <span class='id identifier rubyid_transition_type'>transition_type</span><span class='lparen'>(</span><span class='id identifier rubyid_tx'>tx</span><span class='comma'>,</span> <span class='id identifier rubyid_payment'>payment</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_payment_status'>payment_status</span> <span class='op'>=</span> <span class='id identifier rubyid_payment'>payment</span><span class='lbracket'>[</span><span class='symbol'>:payment_status</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_pending_reason'>pending_reason</span> <span class='op'>=</span> <span class='id identifier rubyid_payment'>payment</span><span class='lbracket'>[</span><span class='symbol'>:pending_reason</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_tx_state'>tx_state</span> <span class='op'>=</span> <span class='id identifier rubyid_tx'>tx</span><span class='period'>.</span><span class='id identifier rubyid_status'>status</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span>

  <span class='id identifier rubyid_transition'>transition</span> <span class='op'>=</span> <span class='id identifier rubyid_first_matching_transition'>first_matching_transition</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="#TRANSITIONS-constant" title="TransactionService::PaypalEvents::TRANSITIONS (constant)">TRANSITIONS</a></span></span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='id identifier rubyid_tx_state'>tx_state</span><span class='comma'>,</span> <span class='id identifier rubyid_payment_status'>payment_status</span><span class='comma'>,</span> <span class='id identifier rubyid_pending_reason'>pending_reason</span><span class='rbracket'>]</span><span class='rparen'>)</span>
  <span class='const'>Maybe</span><span class='lparen'>(</span><span class='id identifier rubyid_transition'>transition</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_or_else'>or_else</span><span class='lparen'>(</span><span class='lbrace'>{</span><span class='label'>name:</span> <span class='symbol'>:unknown</span><span class='comma'>,</span> <span class='label'>actor:</span> <span class='symbol'>:unknown</span><span class='rbrace'>}</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="update_transaction_details-class_method">
  
    .<strong>update_transaction_details</strong>(flow, details)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


53
54
55
56
57
58
59
60
61
62
63</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/services/transaction_service/paypal_events.rb', line 53</span>

<span class='kw'>def</span> <span class='id identifier rubyid_update_transaction_details'>update_transaction_details</span><span class='lparen'>(</span><span class='id identifier rubyid_flow'>flow</span><span class='comma'>,</span> <span class='id identifier rubyid_details'>details</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_community_id'>community_id</span> <span class='op'>=</span> <span class='id identifier rubyid_details'>details</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span><span class='lparen'>(</span><span class='symbol'>:community_id</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_transaction_id'>transaction_id</span> <span class='op'>=</span> <span class='id identifier rubyid_details'>details</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span><span class='lparen'>(</span><span class='symbol'>:transaction_id</span><span class='rparen'>)</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_shipping_fields_present?'>shipping_fields_present?</span><span class='lparen'>(</span><span class='id identifier rubyid_details'>details</span><span class='rparen'>)</span>
    <span class='const'><span class='object_link'><a href="#TransactionStore-constant" title="TransactionService::PaypalEvents::TransactionStore (constant)">TransactionStore</a></span></span><span class='period'>.</span><span class='id identifier rubyid_upsert_shipping_address'>upsert_shipping_address</span><span class='lparen'>(</span>
      <span class='label'>community_id:</span> <span class='id identifier rubyid_community_id'>community_id</span><span class='comma'>,</span>
      <span class='label'>transaction_id:</span> <span class='id identifier rubyid_transaction_id'>transaction_id</span><span class='comma'>,</span>
      <span class='label'>addr:</span> <span class='id identifier rubyid_details'>details</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

      <div id="footer">
  Generated on Tue Feb 11 14:01:44 2020 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.19 (ruby-2.6.2).
</div>

    </div>
  </body>
</html>